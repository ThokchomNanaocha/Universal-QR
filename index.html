<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta tags for character encoding and responsive design -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Universal QR - Products</title>

    <!-- PWA Manifest -->

    <link rel="manifest" href="manifest.json" />

    <!-- PWA Meta Tags -->

    <meta name="theme-color" content="#667eea" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Universal QR" />

    <!-- Apple Touch Icons - Simple QR icon with scanner lines -->

    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect width='180' height='180' fill='%23667eea'/><g fill='white'><rect x='20' y='20' width='40' height='40' rx='4'/><rect x='120' y='20' width='40' height='40' rx='4'/><rect x='20' y='120' width='40' height='40' rx='4'/><rect x='28' y='28' width='24' height='24' fill='%23667eea'/><rect x='128' y='28' width='24' height='24' fill='%23667eea'/><rect x='28' y='128' width='24' height='24' fill='%23667eea'/><rect x='75' y='20' width='4' height='20'/><rect x='85' y='20' width='4' height='20'/><rect x='95' y='20' width='4' height='20'/><rect x='75' y='50' width='4' height='20'/><rect x='95' y='50' width='4' height='20'/><rect x='140' y='75' width='20' height='4'/><rect x='140' y='85' width='20' height='4'/><rect x='140' y='95' width='20' height='4'/><line x1='10' y1='90' x2='170' y2='90' stroke='white' stroke-width='2' opacity='0.6'/></g></svg>"
    />

    <!-- Favicon - Simple Q letter with magnifying glass -->

    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%23667eea'/><circle cx='16' cy='14' r='6' fill='none' stroke='white' stroke-width='2'/><path d='M19 19l3 3' stroke='white' stroke-width='2' stroke-linecap='round'/></svg>"
    />

    <!-- Font Awesome CDN for icons -->

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />

    <!-- QR Code Scanner Library -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>

    <!-- Internal CSS styles for the product display page -->
    <style>
      /* Reset default margins and padding, set font family */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Arial", sans-serif;
      }

      /* Body styling with light background */
      body {
        background-color: #f5f5f5;
        min-height: 100vh;
        margin: 0;
        padding: 0;
        width: 100%;
        overflow-x: hidden;
      }

      /* Full screen container with slight edge padding */
      .page-container {
        width: 100vw;
        min-height: 100vh;
        padding: 0 10px;
        box-sizing: border-box;
      }

      /* Header container styling */
      .header {
        background: white;
        padding: 15px 0px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
        width: 100vw;
        margin: 0 -10px;
        left: 0;
        right: 0;
      }

      /* Header content layout */
      .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        margin: 0;
        padding: 0 20px;
        position: relative;
        gap: 20px;
      }

      /* Voice-search row - hidden on desktop, shown on mobile */
      .voice-search-row {
        display: contents;
        /* This makes the wrapper invisible on desktop */
      }

      /* Hamburger menu - positioned in top right corner */
      .hamburger-menu {
        display: none;
        flex-direction: column;
        cursor: pointer;
        padding: 8px;
        border-radius: 8px;
        transition: background-color 0.3s;
        position: fixed;
        top: 25px;
        right: 20px;
        transform: none;
        z-index: 1001;
      }

      .hamburger-menu:hover {
        background-color: #f8fafc;
      }

      .hamburger-line {
        width: 18px;
        height: 2px;
        background-color: #4f46e5;
        margin: 1.5px 0;
        border-radius: 2px;
        transition: 0.3s;
      }

      /* Hamburger animation when active */
      .hamburger-menu.active .hamburger-line:nth-child(1) {
        transform: rotate(-45deg) translate(-4px, 4px);
      }

      .hamburger-menu.active .hamburger-line:nth-child(2) {
        opacity: 0;
      }

      .hamburger-menu.active .hamburger-line:nth-child(3) {
        transform: rotate(45deg) translate(-4px, -4px);
      }

      /* Mobile profile sidebar panel */
      .mobile-profile-sidebar {
        position: fixed;
        top: 0;
        right: -300px;
        width: 300px;
        height: 100vh;
        background: white;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        transition: right 0.3s ease;
        z-index: 1000;
        padding-top: 80px;
      }

      .mobile-profile-sidebar.open {
        right: 0;
      }

      /* Sidebar overlay */
      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 999;
      }

      .sidebar-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      /* Sidebar header */
      .sidebar-header {
        padding: 20px;
        border-bottom: 1px solid #e2e8f0;
        text-align: center;
      }

      /* Sidebar close button */
      .sidebar-close-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 32px;
        height: 32px;
        border: none;
        background: #f8fafc;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #64748b;
        font-size: 14px;
        transition: all 0.3s ease;
        z-index: 1001;
      }

      .sidebar-close-btn:hover {
        background: #e2e8f0;
        color: #374151;
        transform: scale(1.1);
      }

      .sidebar-user-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      .sidebar-user-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
      }

      .sidebar-user-name {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
      }

      .sidebar-user-email {
        font-size: 14px;
        color: #6b7280;
      }

      .sidebar-user-dept {
        font-size: 12px;
        color: #9ca3af;
      }

      /* Sidebar menu items */
      .sidebar-menu {
        padding: 20px 0;
      }

      .sidebar-menu-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px 20px;
        cursor: pointer;
        transition: background-color 0.3s;
        border: none;
        width: 100%;
        text-align: left;
        background: none;
        font-size: 16px;
        color: #374151;
      }

      .sidebar-menu-item:hover {
        background-color: #f9fafb;
      }

      .sidebar-menu-item i {
        color: #4f46e5;
        width: 20px;
        text-align: center;
      }

      /* Sidebar footer */
      .sidebar-footer {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 20px;
        border-top: 1px solid #e2e8f0;
      }

      .sidebar-version {
        text-align: center;
        font-size: 12px;
        color: #9ca3af;
      }

      /* Voice recorder in header - left side */
      .voice-recorder {
        flex: 0 0 320px;
        display: flex;
        align-items: center;
        justify-content: flex-start;
      }

      /* Search container in the center of header */
      .search-container {
        flex: 1;
        max-width: 500px;
        margin: 0 auto;
        position: relative;
      }

      /* Profile container on the right */
      .profile-container {
        flex: 0 0 180px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        padding: 10px 15px;
        border-radius: 20px;
        transition: background-color 0.3s;
      }

      /* Search input field styling */
      .search-bar {
        width: 100%;
        padding: 14px 50px 14px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 500;
        outline: none;
        transition: all 0.3s ease;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
        background: #ffffff;
      }

      /* Search input focus effect */
      .search-bar:focus {
        border-color: #4f46e5;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1),
          0 2px 8px rgba(0, 0, 0, 0.08);
      }

      /* Search icon positioning */
      .search-icon {
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: #64748b;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        padding: 4px;
        border-radius: 6px;
      }

      .search-icon:hover {
        color: #4f46e5;
        background-color: #f1f5f9;
      }

      .profile-container:hover {
        background-color: #f8fafc;
        transform: translateY(-1px);
      }

      /* Profile icon styling */
      .profile-icon {
        font-size: 32px;
        color: #4f46e5;
        margin-bottom: 4px;
        transition: all 0.3s ease;
      }

      .profile-container:hover .profile-icon {
        color: #4338ca;
        transform: scale(1.05);
      }

      /* Profile text styling */
      .profile-text {
        color: #374151;
        font-size: 12px;
        font-weight: 600;
        text-align: center;
        letter-spacing: 0.3px;
      }

      .profile-container:hover .profile-text {
        color: #1f2937;
      }

      /* Voice recorder button */
      .voice-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #ffffff;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        padding: 14px 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        position: relative;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
      }

      .voice-btn:hover {
        border-color: #4f46e5;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1),
          0 2px 8px rgba(0, 0, 0, 0.08);
      }

      .voice-btn.recording {
        border-color: #ef4444;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1),
          0 2px 8px rgba(0, 0, 0, 0.08);
      }

      /* Voice button left content */
      .voice-content {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* Voice button right content */
      .voice-right-content {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      /* Voice icon styling */
      .voice-icon {
        font-size: 18px;
        color: #64748b;
        transition: all 0.3s ease;
      }

      .voice-btn:hover .voice-icon {
        color: #4f46e5;
      }

      .voice-btn.recording .voice-icon {
        color: #ef4444;
      }

      /* Voice text styling */
      .voice-text {
        font-size: 15px;
        color: #64748b;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .voice-btn:hover .voice-text {
        color: #4f46e5;
      }

      .voice-btn.recording .voice-text {
        color: #ef4444;
      }

      /* Recording timer - positioned on the right side */
      .recording-timer {
        font-size: 12px;
        color: #ef4444;
        font-weight: 600;
        min-width: 35px;
        display: none;
        letter-spacing: 0.3px;
        white-space: nowrap;
      }

      .voice-btn.recording .recording-timer {
        display: block;
      }

      /* Waveform animation container */
      .waveform {
        display: none;
        align-items: center;
        gap: 1px;
        height: 18px;
      }

      .voice-btn.recording .waveform {
        display: flex;
      }

      /* Individual waveform bars */
      .wave-bar {
        width: 2px;
        background: #ef4444;
        border-radius: 2px;
        animation: waveAnimation 1.5s ease-in-out infinite;
      }

      .wave-bar:nth-child(1) {
        animation-delay: 0s;
      }

      .wave-bar:nth-child(2) {
        animation-delay: 0.1s;
      }

      .wave-bar:nth-child(3) {
        animation-delay: 0.2s;
      }

      .wave-bar:nth-child(4) {
        animation-delay: 0.3s;
      }

      .wave-bar:nth-child(5) {
        animation-delay: 0.4s;
      }

      .wave-bar:nth-child(6) {
        animation-delay: 0.2s;
      }

      .wave-bar:nth-child(7) {
        animation-delay: 0.1s;
      }

      @keyframes waveAnimation {
        0%,
        100% {
          height: 4px;
          opacity: 0.6;
        }

        50% {
          height: 16px;
          opacity: 1;
        }
      }

      /* Main content container */
      .main-content {
        width: 100%;
        padding: 20px;
      }

      /* Hero section with tabs and filter */
      .hero-section {
        background: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      /* Controls container for tabs, filter and add button */
      .controls-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      /* Right side controls (filter and add button) */
      .right-controls {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      /* Tab buttons container */
      .tab-buttons {
        display: flex;
        gap: 10px;
      }

      /* Individual tab button styling */
      .tab-button {
        padding: 10px 20px;
        border: 2px solid #e1e1e1;
        background: white;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s;
      }

      /* Active tab button styling */
      .tab-button.active {
        background: #667eea;
        color: white;
        border-color: #667eea;
      }

      /* Tab button hover effect */
      .tab-button:hover:not(.active) {
        border-color: #667eea;
        color: #667eea;
      }

      /* Filter dropdown styling */
      .filter-container {
        position: relative;
      }

      .filter-dropdown {
        padding: 10px 15px;
        border: 2px solid #e1e1e1;
        border-radius: 20px;
        background: white;
        cursor: pointer;
        font-size: 14px;
        min-width: 120px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .filter-dropdown:hover {
        border-color: #667eea;
      }

      .filter-icon {
        font-size: 14px;
        color: #667eea;
      }

      /* Add New Product button styling */
      .add-product-header-btn {
        display: flex;
        align-items: center;
        gap: 10px;
        background: #3b82f6;
        color: white;
        border: none;
        padding: 14px 20px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        white-space: nowrap;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25);
        min-height: 50px;
      }

      .add-product-header-btn:hover {
        background: #2563eb;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
      }

      .add-product-header-btn i {
        font-size: 16px;
      }

      /* Products grid container */
      .products-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 16px;
        margin-bottom: 80px;
        padding: 0;
      }

      /* Individual product card styling */
      .product-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        border: 2px solid transparent;
        transition: border-color 0.2s ease;
      }

      /* Product card hover effect - simple border indication */
      .product-card:hover {
        border-color: #667eea;
      }

      /* Product image placeholder */
      .product-image {
        width: 100%;
        height: 220px;
        border-radius: 0;
        margin-bottom: 15px;
        overflow: hidden;
        position: relative;
      }

      .product-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: none;
        transform: none;
      }

      .product-image img:hover {
        transform: none;
        transition: none;
      }

      /* Product name styling */
      .product-name {
        font-size: 16px;
        font-weight: bold;
        color: #333;
        margin-bottom: 15px;
        line-height: 1.3;
      }

      /* Product location styling */
      .product-location {
        font-size: 14px;
        color: #666;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      /* Location icon styling */
      .location-icon {
        color: #667eea;
      }

      /* Product info container for location and department */
      .product-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
      }

      /* Department badge styling */
      .department-badge {
        background: #6b7280;
        color: white;
        font-size: 11px;
        font-weight: 500;
        padding: 4px 8px;
        border-radius: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        white-space: nowrap;
      }

        /* Bottom action buttons container */
        .bottom-actions {
            position: fixed;
            bottom: 15px;
            left: 0;
            right: 0;
            background: white;
            padding: 8px 16px;
            box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.15);
            display: none !important;
            /* Force hidden on desktop */
            justify-content: center;
            gap: 12px;
            z-index: 1001;
            border-radius: 0;
            border-top: 1px solid #e2e8f0;
        }

        /* Action button styling - more button-like */
        .action-button {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            background: #667eea;
            color: white;
            border: none;
            font-weight: 600;
            font-size: 11px;
            min-width: 90px;
            flex: 1;
            box-shadow: 0 2px 12px rgba(102, 126, 234, 0.25);
        }

      .action-button:hover {
        background: #5a6fd8;
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(102, 126, 234, 0.35);
      }

      .action-button:active {
        transform: translateY(0);
      }

        /* Action button icon styling */
        .action-icon {
            font-size: 13px;
            margin-right: 5px;
        }

        /* Action button text styling */
        .action-text {
            font-size: 11px;
            font-weight: 600;
            line-height: 1.2;
        }

      /* Pagination container */
      .pagination-container {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 40px 0;
        gap: 10px;
        flex-wrap: wrap;
      }

      .pagination-button {
        padding: 10px 15px;
        border: 2px solid #e2e8f0;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        color: #64748b;
        transition: all 0.3s ease;
        min-width: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .pagination-button:hover {
        border-color: #4f46e5;
        color: #4f46e5;
        background-color: #f8fafc;
      }

      .pagination-button.active {
        background: #4f46e5;
        color: white;
        border-color: #4f46e5;
      }

      .pagination-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        border-color: #e2e8f0;
        color: #94a3b8;
      }

      .pagination-button:disabled:hover {
        border-color: #e2e8f0;
        color: #94a3b8;
        background: white;
      }

      .pagination-info {
        color: #64748b;
        font-size: 14px;
        margin: 0 15px;
      }

      /* Desktop media query to ensure bottom actions are hidden */
      @media (min-width: 769px) {
        .bottom-actions {
          display: none !important;
        }
      }

      /* Responsive design for mobile devices */
      @media (max-width: 768px) {
        /* Full screen container with smaller edge padding on mobile */
        .page-container {
          padding: 0 5px;
        }

        /* Adjust header for mobile - keep horizontal layout for voice and search */
        .header-content {
          flex-direction: column;
          gap: 12px;
          padding: 0 15px 0 15px;
          align-items: stretch;
          padding-right: 70px;
          /* Add space for hamburger menu */
        }

        /* Voice and search horizontal layout */
        .voice-search-row {
          display: flex;
          gap: 8px;
          align-items: center;
          order: 1;
          transition: all 0.3s ease;
          position: relative;
        }

        .voice-recorder {
          flex: 0 0 50%;
          order: 1;
          justify-content: center;
          min-width: auto;
          transition: all 0.3s ease;
          position: relative;
        }

        .voice-recorder.expanded {
          flex: 0 0 70%;
        }

        .voice-recorder.collapsed {
          flex: 0 0 60px;
          justify-content: center;
        }

        .search-container {
          flex: 0 0 50%;
          order: 2;
          max-width: none;
          margin: 0;
          transition: all 0.3s ease;
          position: relative;
        }

        .search-container.expanded {
          flex: 0 0 70%;
        }

        .search-container.collapsed {
          flex: 0 0 60px;
          display: flex;
          justify-content: center;
          align-items: center;
          overflow: hidden;
        }

        /* Collapsed state styling */
        .voice-recorder.collapsed .voice-btn {
          width: 50px;
          height: 50px;
          padding: 0;
          justify-content: center;
          align-items: center;
          border-radius: 50%;
        }

        .voice-recorder.collapsed .voice-text,
        .voice-recorder.collapsed .voice-right-content {
          display: none;
        }

        .search-container.collapsed .search-bar {
          display: none;
        }

        .search-container.collapsed .search-icon {
          position: static;
          transform: none;
          font-size: 18px;
          padding: 15px;
          border-radius: 50%;
          background-color: #f1f5f9;
          color: #4f46e5;
          width: 50px;
          height: 50px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: all 0.3s ease;
          margin-right: 10px;
          /* Add margin to prevent overlap with hamburger */
        }

        .search-container.collapsed .search-icon:hover {
          background-color: #e2e8f0;
          transform: scale(1.05);
        }

        /* Hide desktop profile, show hamburger menu */
        .profile-container {
          display: none;
        }

        .hamburger-menu {
          display: flex;
        }

        .profile-icon {
          font-size: 28px;
          margin-bottom: 0;
          margin-right: 8px;
        }

        .profile-text {
          font-size: 12px;
          font-weight: 600;
        }

        .search-bar {
          padding: 12px 45px 12px 16px;
          font-size: 14px;
          border-radius: 10px;
        }

        .search-icon {
          right: 14px;
          font-size: 14px;
        }

        .voice-btn {
          padding: 12px 16px;
          border-radius: 10px;
        }

        .voice-icon {
          font-size: 16px;
        }

        .voice-text {
          font-size: 13px;
        }

        .recording-timer {
          font-size: 11px;
          min-width: 30px;
        }

        .waveform {
          height: 14px;
          gap: 1px;
        }

        .wave-bar {
          width: 2px;
        }

        @keyframes waveAnimation {
          0%,
          100% {
            height: 3px;
            opacity: 0.6;
          }

          50% {
            height: 12px;
            opacity: 1;
          }
        }

        /* Stack controls vertically on mobile */
        .controls-container {
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
          gap: 10px;
        }

        .right-controls {
          gap: 10px;
        }

        .tab-buttons {
          justify-content: flex-start;
          gap: 8px;
        }

        /* Mobile responsive for add product button - hide completely on mobile */
        .add-product-header-btn {
          display: none;
        }

        .tab-button {
          padding: 8px 16px;
          font-size: 13px;
          border-radius: 18px;
        }

        .filter-dropdown {
          padding: 8px 12px;
          font-size: 13px;
          min-width: 100px;
          border-radius: 18px;
        }

        .filter-icon {
          font-size: 12px;
        }

            /* Reduce grid margin to account for smaller bottom actions */
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
                margin-bottom: 90px;
                /* Account for bottom actions at bottom: 15px */
            }

        /* Adjust main content padding */
        .main-content {
          padding: 15px;
        }

            /* Show bottom actions on mobile with smaller padding */
            .bottom-actions {
                display: flex !important;
                /* Override desktop hidden state */
                gap: 10px;
                padding: 8px 16px;
                bottom: 15px;
                left: 0;
                right: 0;
                z-index: 1001;
                position: fixed;
            }

            .action-button {
                min-width: 90px;
                padding: 6px 12px;
                font-size: 11px;
                border-radius: 8px;
            }

        /* Show both add product and camera buttons in mobile view */
        .add-product-btn {
          display: flex;
          background: #60a5fa;
          color: white;
          border: 2px solid #60a5fa;
        }

        .add-product-btn:hover {
          background: #3b82f6;
          border-color: #3b82f6;
          transform: translateY(-1px);
          box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3);
        }

        .camera-btn {
          display: flex;
          background: #60a5fa;
          color: white;
          border: 2px solid #60a5fa;
        }

        .camera-btn:hover {
          background: #3b82f6;
          border-color: #3b82f6;
          transform: translateY(-1px);
          box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3);
        }

            /* Mobile action icon and text adjustments */
            .action-icon {
                font-size: 13px;
                margin-right: 5px;
            }

            .action-text {
                font-size: 11px;
                font-weight: 600;
            }

        .action-icon {
          font-size: 14px;
          margin-right: 6px;
        }

        .action-text {
          font-size: 13px;
        }

        /* Mobile pagination styling */
        .pagination-container {
          margin: 20px 0 80px 0;
          gap: 8px;
          padding: 0 10px;
        }

        .pagination-button {
          padding: 8px 12px;
          font-size: 13px;
          min-width: 38px;
          border-radius: 6px;
        }

        .pagination-info {
          font-size: 12px;
          margin: 0 8px;
          white-space: nowrap;
        }
      }

      @media (max-width: 480px) {
        /* Further mobile optimizations */
        .page-container {
          padding: 0 3px;
        }

        .header-content {
          flex-direction: column;
          gap: 10px;
          padding: 0 10px 0 10px;
          align-items: stretch;
          padding-right: 60px;
          /* Add space for hamburger menu */
        }

        /* Voice and search horizontal layout */
        .voice-search-row {
          display: flex;
          gap: 6px;
          align-items: center;
          order: 1;
          transition: all 0.3s ease;
          position: relative;
        }

        .voice-recorder {
          flex: 0 0 50%;
          order: 1;
          justify-content: center;
          min-width: auto;
          transition: all 0.3s ease;
          position: relative;
        }

        .voice-recorder.expanded {
          flex: 0 0 75%;
        }

        .voice-recorder.collapsed {
          flex: 0 0 50px;
          justify-content: center;
        }

        .search-container {
          flex: 0 0 50%;
          order: 2;
          max-width: none;
          margin: 0;
          transition: all 0.3s ease;
          position: relative;
        }

        .search-container.expanded {
          flex: 0 0 75%;
        }

        .search-container.collapsed {
          flex: 0 0 50px;
          display: flex;
          justify-content: center;
          align-items: center;
          overflow: hidden;
        }

        /* Collapsed state styling for smaller screens */
        .voice-recorder.collapsed .voice-btn {
          width: 45px;
          height: 45px;
          padding: 0;
          justify-content: center;
          align-items: center;
          border-radius: 50%;
        }

        .voice-recorder.collapsed .voice-text,
        .voice-recorder.collapsed .voice-right-content {
          display: none;
        }

        .search-container.collapsed .search-bar {
          display: none;
        }

        .search-container.collapsed .search-icon {
          position: static;
          transform: none;
          font-size: 16px;
          padding: 14px;
          border-radius: 50%;
          background-color: #f1f5f9;
          color: #667eea;
          width: 45px;
          height: 45px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: all 0.3s ease;
          margin-right: 8px;
          /* Add margin to prevent overlap with hamburger */
        }

        .search-container.collapsed .search-icon:hover {
          background-color: #e2e8f0;
          transform: scale(1.05);
        }

        /* Hide desktop profile, show hamburger menu */
        .profile-container {
          display: none;
        }

        .hamburger-menu {
          display: flex;
        }

        .profile-icon {
          font-size: 24px;
          margin-bottom: 0;
          margin-right: 6px;
        }

        .profile-text {
          font-size: 11px;
          font-weight: 600;
        }

        .voice-btn {
          padding: 10px 14px;
          border-radius: 8px;
        }

        .voice-icon {
          font-size: 14px;
        }

        .voice-text {
          font-size: 12px;
        }

        .recording-timer {
          font-size: 10px;
          min-width: 25px;
        }

        .waveform {
          height: 12px;
          gap: 1px;
        }

        .wave-bar {
          width: 1.5px;
        }

        @keyframes waveAnimation {
          0%,
          100% {
            height: 2px;
            opacity: 0.6;
          }

          50% {
            height: 10px;
            opacity: 1;
          }
        }

        .products-grid {
          grid-template-columns: 1fr;
        }

        .tab-button {
          padding: 6px 12px;
          font-size: 12px;
          border-radius: 16px;
        }

        .filter-dropdown {
          padding: 6px 10px;
          font-size: 12px;
          min-width: 90px;
          border-radius: 16px;
        }

        .filter-icon {
          font-size: 11px;
        }

        /* Smaller mobile pagination styling */
        .pagination-container {
          margin: 15px 0 70px 0;
          gap: 6px;
          padding: 0 8px;
        }

        .pagination-button {
          padding: 6px 10px;
          font-size: 12px;
          min-width: 34px;
          border-radius: 5px;
        }

        .pagination-info {
          font-size: 11px;
          margin: 0 6px;
          white-space: nowrap;
        }

        /* Hide add product header button in smaller mobile view too */
        .add-product-header-btn {
          display: none;
        }
      }

      /* Notification styles */
      .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        max-width: 350px;
      }

      .notification {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 16px 20px;
        border-radius: 12px;
        margin-bottom: 10px;
        box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        transform: translateX(400px);
        opacity: 0;
        transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .notification.show {
        transform: translateX(0);
        opacity: 1;
      }

      .notification.hide {
        transform: translateX(400px);
        opacity: 0;
      }

      .notification-icon {
        flex-shrink: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        font-size: 12px;
      }

      .notification-content {
        flex: 1;
      }

      .notification-title {
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 4px;
      }

      .notification-message {
        font-size: 13px;
        opacity: 0.9;
        line-height: 1.4;
      }

      .notification-close {
        flex-shrink: 0;
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        opacity: 0.8;
        font-size: 16px;
        padding: 4px;
        border-radius: 4px;
        transition: opacity 0.2s ease;
      }

      .notification-close:hover {
        opacity: 1;
        background: rgba(255, 255, 255, 0.1);
      }

      /* Mobile responsive notifications */
      @media (max-width: 768px) {
        .notification-container {
          top: 10px;
          right: 10px;
          left: 10px;
          max-width: none;
        }

        .notification {
          transform: translateY(-100px);
        }

        .notification.show {
          transform: translateY(0);
        }

            .notification.hide {
                transform: translateY(-100px);
            }
        }

        /* PWA Install Prompt Styles */
        .pwa-install-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            animation: fadeIn 0.3s ease-out;
        }

        .pwa-install-overlay.show {
            display: flex;
        }

        .pwa-install-popup {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 30px 25px;
            max-width: 380px;
            width: 100%;
            text-align: center;
            color: white;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4);
            transform: translateY(50px);
            opacity: 0;
            animation: slideUp 0.4s ease-out forwards;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .pwa-install-icon {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 35px;
            color: white;
            animation: bounce 2s infinite;
        }

        .pwa-install-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ffffff, #f0f0f0);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .pwa-install-message {
            font-size: 16px;
            margin-bottom: 25px;
            opacity: 0.95;
            line-height: 1.5;
        }

        .pwa-install-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .pwa-install-btn {
            background: rgba(255, 255, 255, 0.95);
            color: #667eea;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
        }

        .pwa-install-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 255, 255, 0.3);
        }

        .pwa-cancel-btn {
            background: transparent;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .pwa-cancel-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.8);
            transform: translateY(-2px);
        }

        .pwa-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pwa-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* PWA Feature highlights */
        .pwa-features {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            text-align: center;
        }

        .pwa-feature {
            flex: 1;
            padding: 0 10px;
        }

        .pwa-feature-icon {
            font-size: 24px;
            margin-bottom: 8px;
            opacity: 0.9;
        }

        .pwa-feature-text {
            font-size: 12px;
            opacity: 0.85;
            line-height: 1.3;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        /* Mobile responsive for PWA install prompt */
        @media (max-width: 768px) {
            .pwa-install-popup {
                margin: 0 10px;
                padding: 25px 20px;
                max-width: 350px;
            }

            .pwa-install-title {
                font-size: 22px;
            }

            .pwa-install-message {
                font-size: 15px;
            }

            .pwa-install-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .pwa-install-btn,
            .pwa-cancel-btn {
                width: 100%;
                min-width: auto;
            }
        }
    </style>
  </head>

  <body>
    <!-- IMMEDIATE install button prevention - runs first -->
    <script>
      // NUCLEAR PREVENTION - runs immediately when body starts loading
      (function () {
        console.log(
          "🚫 IMMEDIATE: Installing ultra-aggressive install button prevention..."
        );

        // Ultra-aggressive cleanup every 50ms
        const ultraCleanup = setInterval(() => {
          try {
            const elements = document.querySelectorAll("*");
            elements.forEach((el) => {
              if (!el) return;

              const text = el.textContent || "";
              const innerHTML = el.innerHTML || "";
              const id = el.id || "";
              const className = el.className || "";

              // Check for any install-related content
              const hasInstallContent =
                text.toLowerCase().includes("install") ||
                innerHTML.includes("📱") ||
                text.includes("Add to") ||
                id.toLowerCase().includes("install") ||
                className.toLowerCase().includes("install");

              // Check for suspicious positioning
              const style = window.getComputedStyle(el);
              const isSuspiciousPosition =
                style.position === "fixed" &&
                parseInt(style.top) <= 100 &&
                parseInt(style.left) <= 100;

              // Remove if matches criteria
              if (
                (hasInstallContent || isSuspiciousPosition) &&
                (el.tagName === "BUTTON" ||
                  el.tagName === "DIV" ||
                  el.tagName === "SPAN")
              ) {
                console.log(
                  "🗑️ ULTRA-CLEANUP: Removing element:",
                  el.tagName,
                  text.substring(0, 50),
                  id
                );
                el.remove();
              }
            });
          } catch (e) {
            // Ignore errors during aggressive cleanup
          }
        }, 50);

        // Stop ultra cleanup after 30 seconds
        setTimeout(() => {
          console.log("🔄 Reducing cleanup frequency after 30 seconds");
          clearInterval(ultraCleanup);
        }, 30000);
      })();
    </script>

    <!-- Notification container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- PWA Install Prompt Overlay -->
    <div class="pwa-install-overlay" id="pwaInstallOverlay">
        <div class="pwa-install-popup">
            <button class="pwa-close-btn" onclick="closePWAPrompt()">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="pwa-install-icon">
                <i class="fas fa-mobile-alt"></i>
            </div>
            
            <h3 class="pwa-install-title">Add to Home Screen</h3>
            <p class="pwa-install-message">Universal QR is better as an app! Get faster access and a native experience.</p>
            
            <div class="pwa-features">
                <div class="pwa-feature">
                    <div class="pwa-feature-icon">⚡</div>
                    <div class="pwa-feature-text">Lightning Fast</div>
                </div>
                <div class="pwa-feature">
                    <div class="pwa-feature-icon">📱</div>
                    <div class="pwa-feature-text">Native Feel</div>
                </div>
                <div class="pwa-feature">
                    <div class="pwa-feature-icon">🔄</div>
                    <div class="pwa-feature-text">Works Offline</div>
                </div>
            </div>
            
            <div class="pwa-install-buttons">
                <button class="pwa-install-btn" onclick="installPWA()">
                    <i class="fas fa-download" style="margin-right: 8px;"></i>
                    Install App
                </button>
                <button class="pwa-cancel-btn" onclick="dismissPWAPrompt()">
                    Maybe Later
                </button>
            </div>
        </div>
    </div>

    <!-- TEMPORARY TEST BUTTON - Remove after testing -->
    <button onclick="testPWAPrompt()" style="position:fixed;top:10px;left:10px;z-index:99999;background:red;color:white;padding:10px;border:none;border-radius:5px;font-size:12px;">TEST PWA</button>

    <!-- Full screen page container with edge padding -->
    <div class="page-container">
      <!-- Main header section with voice recorder, search and profile -->
      <header class="header">
        <div class="header-content">
          <!-- Voice recorder and search in horizontal row on mobile -->
          <div class="voice-search-row">
            <!-- Voice recorder on the left -->
            <div class="voice-recorder" id="voiceRecorderContainer">
              <div
                class="voice-btn"
                id="voiceRecorderBtn"
                onclick="toggleVoiceRecording()"
              >
                <div class="voice-content">
                  <i class="fas fa-microphone voice-icon" id="voiceIcon"></i>
                  <span class="voice-text" id="voiceText">Voice Record</span>
                </div>
                <div class="voice-right-content">
                  <!-- Waveform animation -->
                  <div class="waveform" id="waveform">
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                  </div>
                  <!-- Timer on the side -->
                  <div class="recording-timer" id="recordingTimer">00:00</div>
                </div>
              </div>
            </div>

            <!-- Search bar container in the center -->
            <div class="search-container" id="searchContainer">
              <input
                type="text"
                class="search-bar"
                placeholder="Search products..."
                id="searchInput"
                onfocus="expandSearch()"
                onblur="collapseSearch()"
              />
              <i
                class="fas fa-search search-icon"
                onclick="handleSearchIconClick()"
              ></i>
            </div>
          </div>

          <!-- Profile icon and text on the right -->
          <div class="profile-container" onclick="openProfile()">
            <i class="fas fa-user-circle profile-icon"></i>
            <span class="profile-text">My Profile</span>
          </div>

          <!-- Hamburger menu for mobile -->
          <div class="hamburger-menu" onclick="toggleMobileSidebar()">
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
          </div>
        </div>
      </header>

      <!-- Sidebar overlay -->
      <div
        class="sidebar-overlay"
        id="sidebarOverlay"
        onclick="closeMobileSidebar()"
      ></div>

      <!-- Mobile profile sidebar -->
      <div class="mobile-profile-sidebar" id="mobileProfileSidebar">
        <!-- Close button at top right of entire sidebar -->
        <button
          class="sidebar-close-btn"
          onclick="closeMobileSidebar()"
          title="Close sidebar"
        >
          <i class="fas fa-times"></i>
        </button>

        <!-- Sidebar Header -->
        <div class="sidebar-header">
          <div class="sidebar-user-info">
            <div class="sidebar-user-avatar">
              <i class="fas fa-user"></i>
            </div>
            <div class="sidebar-user-name">John Doe</div>
            <div class="sidebar-user-email">john.doe@company.com</div>
            <div class="sidebar-user-dept">Production Department</div>
          </div>
        </div>

        <!-- Sidebar Menu -->
        <div class="sidebar-menu">
          <!-- Menu items removed - only showing user info and logout -->
        </div>

        <!-- Sidebar Footer -->
        <div class="sidebar-footer">
          <button
            class="sidebar-menu-item"
            onclick="logout()"
            style="
              color: #ef4444;
              border-top: 1px solid #e2e8f0;
              padding-top: 15px;
            "
          >
            <i class="fas fa-sign-out-alt" style="color: #ef4444"></i>
            <span>Logout</span>
          </button>
          <div class="sidebar-version">Version 1.0.0</div>
        </div>
      </div>

      <!-- Main content area -->
      <main class="main-content">
        <!-- Hero section with tab buttons and filter -->
        <section class="hero-section">
          <div class="controls-container">
            <!-- Tab buttons for Mine/All selection -->
            <div class="tab-buttons">
              <button class="tab-button active" onclick="switchTab('mine')">
                Mine
              </button>
              <button class="tab-button" onclick="switchTab('all')">All</button>
            </div>

            <!-- Right side controls: Filter and Add New Product -->
            <div class="right-controls">
              <!-- Filter dropdown -->
              <div class="filter-container">
                <div class="filter-dropdown" onclick="toggleFilter()">
                  <i class="fas fa-filter filter-icon"></i>
                  <span id="filterText">Filter</span>
                  <i class="fas fa-chevron-down"></i>
                </div>
              </div>

                        <!-- Add New Product button -->
                        <button class="add-product-header-btn" onclick="addNewProduct()">
                            <i class="fas fa-plus"></i>
                            <span>Add New Product</span>
                        </button>
                        
                        <!-- PWA Test Button -->
                        <button class="add-product-header-btn" onclick="testShowPWA()" style="background: #e74c3c; margin-left: 10px;">
                            <i class="fas fa-mobile-alt"></i>
                            <span>Test PWA</span>
                        </button>
                    </div>
                </div>
            </section>

        <!-- Products grid section -->
        <section class="products-section">
          <div class="products-grid" id="productsGrid">
            <!-- Demo product cards will be generated by JavaScript -->
          </div>

          <!-- Pagination -->
          <div class="pagination-container" id="paginationContainer">
            <!-- Pagination will be generated by JavaScript -->
          </div>
        </section>
      </main>
    </div>

    <!-- Bottom action buttons -->
    <div class="bottom-actions">
      <!-- Add new product button -->
      <div class="action-button add-product-btn" onclick="addNewProduct()">
        <i class="fas fa-plus action-icon"></i>
        <span class="action-text">Add Product</span>
      </div>

      <!-- Scan QR button -->
      <div class="action-button camera-btn" onclick="openCamera()">
        <i class="fas fa-qrcode action-icon"></i>
        <span class="action-text">Scan QR</span>
      </div>
    </div>

    <!-- JavaScript for interactivity and demo data -->

    <script>
        // SIMPLE PWA INSTALL PROMPT - GUARANTEED TO SHOW
        console.log('🚀 Starting SIMPLE PWA setup...');

        // Check if mobile with detailed logging
        function isMobileDevice() {
            const userAgent = navigator.userAgent;
            const windowWidth = window.innerWidth;
            const regexTest = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            console.log('🔍 MOBILE DETECTION DEBUG:');
            console.log('📱 User Agent:', userAgent);
            console.log('📏 Window Width:', windowWidth);
            console.log('🧬 Regex Test Result:', regexTest);
            console.log('✅ Width Test (<=768):', windowWidth <= 768);
            
            const isMobile = regexTest || windowWidth <= 768;
            console.log('🎯 FINAL MOBILE RESULT:', isMobile);
            
            return isMobile;
        }

        // Check if PWA is already installed with detailed logging
        function isPWAInstalled() {
            console.log('🔍 PWA INSTALLATION CHECK:');
            
            // Check display mode
            const standaloneMode = window.matchMedia('(display-mode: standalone)').matches;
            console.log('📱 Standalone Mode:', standaloneMode);
            
            // Check iOS standalone
            const iOSStandalone = navigator.standalone === true;
            console.log('🍎 iOS Standalone:', iOSStandalone);
            
            // Check Android app context
            const androidApp = document.referrer.startsWith('android-app://');
            console.log('🤖 Android App Context:', androidApp);
            
            const isInstalled = standaloneMode || iOSStandalone || androidApp;
            console.log('🎯 FINAL INSTALLATION RESULT:', isInstalled);
            
            return isInstalled;
        }

        // Simple PWA install prompt that WILL show up
        function showSimplePWAPrompt() {
            console.log('📱 Showing SIMPLE PWA prompt...');
            
            // Create a simple, unavoidable prompt
            const promptDiv = document.createElement('div');
            promptDiv.id = 'simplePWAPrompt';
            promptDiv.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(0, 0, 0, 0.8);
                    z-index: 999999;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-family: Arial, sans-serif;
                ">
                    <div style="
                        background: white;
                        border-radius: 15px;
                        padding: 30px 25px;
                        max-width: 350px;
                        width: 90%;
                        text-align: center;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    ">
                        <div style="
                            font-size: 48px;
                            margin-bottom: 20px;
                        ">📱</div>
                        
                        <h2 style="
                            color: #333;
                            margin-bottom: 15px;
                            font-size: 22px;
                        ">Add Universal QR to Home Screen</h2>
                        
                        <p style="
                            color: #666;
                            margin-bottom: 25px;
                            line-height: 1.5;
                            font-size: 16px;
                        ">Get quick access to Universal QR by adding it to your home screen. It works like a native app!</p>
                        
                        <div style="
                            display: flex;
                            gap: 12px;
                            justify-content: center;
                        ">
                            <button onclick="installSimplePWA()" style="
                                background: #667eea;
                                color: white;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 8px;
                                font-size: 16px;
                                font-weight: 600;
                                cursor: pointer;
                                flex: 1;
                            ">
                                Add to Home Screen
                            </button>
                            
                            <button onclick="closeSimplePWAPrompt()" style="
                                background: #f0f0f0;
                                color: #666;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 8px;
                                font-size: 16px;
                                cursor: pointer;
                                flex: 1;
                            ">
                                Not Now
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(promptDiv);
            console.log('✅ SIMPLE PWA prompt added to page');
        }

        // Install PWA function
        let deferredPrompt = null;

        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('💾 Deferred prompt captured');
            e.preventDefault();
            deferredPrompt = e;
        });

        function installSimplePWA() {
            console.log('📱 User wants to install PWA');
            
            if (deferredPrompt) {
                console.log('🎯 Using browser install prompt');
                deferredPrompt.prompt();
                
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('✅ User installed the PWA');
                        closeSimplePWAPrompt();
                        alert('App installed! Look for Universal QR icon on your home screen.');
                    } else {
                        console.log('❌ User dismissed install');
                    }
                    deferredPrompt = null;
                });
            } else {
                console.log('📋 Showing manual install instructions');
                showManualInstructions();
            }
        }

        function showManualInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            let instructions = '';
            
            if (isIOS) {
                instructions = `To install on iOS:
        
1. Tap the Share button (📤) at the bottom of Safari
2. Scroll down and tap "Add to Home Screen"
3. Tap "Add" to confirm

Your app will appear on your home screen!`;
            } else if (isAndroid) {
                instructions = `To install on Android:
        
1. Tap the menu (⋮) in your browser
2. Look for "Add to Home screen" or "Install app"
3. Follow the prompts to install

Your app will appear on your home screen!`;
            } else {
                instructions = `To install:
        
Look for an install icon in your browser's address bar, or check your browser menu for "Install app" option.`;
            }
            
            alert(instructions);
            closeSimplePWAPrompt();
        }

        function closeSimplePWAPrompt() {
            const prompt = document.getElementById('simplePWAPrompt');
            if (prompt) {
                prompt.remove();
            }
            
            // Remember user's choice for 7 days
            localStorage.setItem('pwa-prompt-dismissed', Date.now());
        }

        // Check if we should show the prompt with detailed logging
        function shouldShowPWAPrompt() {
            console.log('🔍 PWA PROMPT DECISION LOGIC:');
            
            // Check mobile
            const mobile = isMobileDevice();
            console.log('📱 Is Mobile:', mobile);
            
            // Check installation
            const installed = isPWAInstalled();
            console.log('📲 Is Installed:', installed);
            
            // Check dismissal
            const dismissed = localStorage.getItem('pwa-prompt-dismissed');
            console.log('⏰ Dismissal Data:', dismissed);
            
            if (dismissed) {
                const dismissedTime = parseInt(dismissed);
                const daysSince = (Date.now() - dismissedTime) / (1000 * 60 * 60 * 24);
                console.log('📅 Days Since Dismissal:', daysSince.toFixed(2));
                
                if (daysSince < 7) {
                    console.log('❌ BLOCKED: Recently dismissed (< 7 days)');
                    return false;
                }
            }
            
            if (!mobile) {
                console.log('❌ BLOCKED: Not mobile device');
                return false;
            }
            
            if (installed) {
                console.log('❌ BLOCKED: PWA already installed');
                return false;
            }
            
            console.log('✅ SHOULD SHOW: All conditions met');
            return true;
        }

        // Show prompt immediately when page loads on mobile
        document.addEventListener('DOMContentLoaded', () => {
            console.log('� === PWA INITIALIZATION DEBUG ===');
            console.log('�📄 DOM Content Loaded at:', new Date().toISOString());
            
            // Environment check
            console.log('🌍 Environment Information:');
            console.log('📱 User Agent:', navigator.userAgent);
            console.log('📏 Viewport:', window.innerWidth + 'x' + window.innerHeight);
            console.log('🔗 URL:', window.location.href);
            console.log('🌐 Protocol:', window.location.protocol);
            console.log('🏠 Origin:', window.location.origin);
            
            // Feature support check
            console.log('🔍 Browser Feature Support:');
            console.log('📋 getUserMedia:', !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia));
            console.log('📱 matchMedia:', !!window.matchMedia);
            console.log('💾 localStorage:', !!window.localStorage);
            console.log('🎮 beforeinstallprompt:', 'onbeforeinstallprompt' in window);
            
            // Check PWA conditions
            console.log('🎯 PWA Decision Process:');
            const shouldShow = shouldShowPWAPrompt();
            
            if (shouldShow) {
                console.log('✅ CONDITIONS MET: Scheduling PWA prompt in 1 second...');
                setTimeout(() => {
                    console.log('⏰ TIMER TRIGGERED: Showing PWA prompt now');
                    showSimplePWAPrompt();
                }, 1000);
            } else {
                console.log('❌ CONDITIONS NOT MET: PWA prompt will not show');
            }
            
            console.log('🔧 PWA initialization complete');
        });

        // Listen for successful installation
        window.addEventListener('appinstalled', (evt) => {
            console.log('🎉 PWA installed successfully');
            alert('Universal QR has been installed! You can now access it from your home screen.');
            closeSimplePWAPrompt();
        });

        console.log('🔧 SIMPLE PWA setup complete');

        // FORCE SHOW PWA TEST FUNCTION - Enhanced with debugging
        function testShowPWA() {
            console.log('🧪 === MANUAL PWA TEST STARTED ===');
            
            // Clear dismissals
            localStorage.removeItem('pwa-prompt-dismissed');
            console.log('🧹 Cleared dismissal data');
            
            // Force check conditions
            console.log('🔍 Current Environment Check:');
            console.log('📱 User Agent:', navigator.userAgent);
            console.log('📏 Screen Width:', window.innerWidth);
            console.log('🌐 Protocol:', window.location.protocol);
            console.log('🔗 URL:', window.location.href);
            
            // Check PWA support
            console.log('🔍 PWA Support Check:');
            console.log('📋 beforeinstallprompt supported:', 'onbeforeinstallprompt' in window);
            console.log('📱 standalone supported:', 'standalone' in navigator);
            console.log('🎮 matchMedia supported:', 'matchMedia' in window);
            
            // Remove existing prompt
            const existingPrompt = document.getElementById('simplePWAPrompt');
            if (existingPrompt) {
                console.log('🗑️ Removing existing prompt');
                existingPrompt.remove();
            }
            
            // Force show prompt
            console.log('🚀 FORCING PWA PROMPT TO SHOW...');
            showSimplePWAPrompt();
        }

        // IMMEDIATE TEST - Show PWA prompt in 2 seconds regardless of conditions
        setTimeout(() => {
            console.log('🚨 === EMERGENCY PWA TEST (2 seconds) ===');
            console.log('⏰ Auto-test triggered at:', new Date().toISOString());
            testShowPWA();
        }, 2000);

        // Old PWA functions removed - using simple version above

        // Dismiss the PWA prompt
        function dismissPWAPrompt() {
            console.log('❌ User dismissed PWA prompt');
            closePWAPrompt();
            
            // Remember dismissal for 7 days
            localStorage.setItem('pwa-dismissed-time', Date.now().toString());
        }

        // Close the PWA prompt
        function closePWAPrompt() {
            const overlay = document.getElementById('pwaInstallOverlay');
            if (overlay) {
                overlay.classList.remove('show');
            }
        }

        // TEMPORARY TEST FUNCTION - Remove after testing
        function testPWAPrompt() {
            console.log('🧪 Testing PWA prompt manually...');
            
            // Clear localStorage to reset any dismissals
            localStorage.removeItem('pwa-dismissed-time');
            localStorage.removeItem('pwa-prompt-shown-time');
            
            // Reset state
            hasShownPrompt = false;
            
            // Force show the prompt
            const overlay = document.getElementById('pwaInstallOverlay');
            if (overlay) {
                overlay.classList.add('show');
                console.log('✅ PWA prompt should now be visible');
            } else {
                console.error('❌ PWA overlay element not found');
            }
        }

        // Listen for the beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('🎯 beforeinstallprompt event fired');
            
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            
            // Save the event so it can be triggered later
            deferredPrompt = e;
            isInstallable = true;
            
            console.log('💾 Deferred prompt saved, installable:', isInstallable);
            
            // Show our custom prompt after a short delay if conditions are met
            setTimeout(() => {
                showSimplePWAPrompt();
            }, 2000); // Wait 2 seconds after page load
        });

        // Listen for app installation
        window.addEventListener('appinstalled', (evt) => {
            console.log('🎉 PWA was installed successfully');
            showNotification('App Installed!', 'Universal QR has been added to your home screen', 'success');
            
            // Clear any stored dismissal data
            localStorage.removeItem('pwa-dismissed-time');
            localStorage.removeItem('pwa-prompt-shown-time');
            
            deferredPrompt = null;
        });

        // End of SIMPLE PWA setup

        // Aggressive cleanup function - FIXED to protect our PWA prompt
        function removeInstallButtons() {
            let removed = false;
            
            // Remove by ID
            const installBtn = document.getElementById('installButton');
            if (installBtn && installBtn.id !== 'simplePWAPrompt') {
                console.log('🗑️ Removing install button by ID');
                installBtn.remove();
                removed = true;
            }
            
            // Remove any buttons with install-related attributes or content
            const allButtons = document.querySelectorAll('button, div, span, a');
            allButtons.forEach(element => {
                // PROTECTION: Never remove our simple PWA prompt or its children
                if (element.id === 'simplePWAPrompt' || 
                    element.closest('#simplePWAPrompt') ||
                    element.getAttribute('onclick')?.includes('installSimplePWA') ||
                    element.getAttribute('onclick')?.includes('closeSimplePWAPrompt')) {
                    console.log('🛡️ PROTECTING simple PWA prompt from cleanup:', element.tagName);
                    return; // Skip this element
                }
                
                const style = window.getComputedStyle(element);
                const text = element.textContent || '';
                const innerHTML = element.innerHTML || '';
                const id = element.id || '';
                const className = element.className || '';
                
                // Check for install-related content or positioning
                const hasInstallContent = text.toLowerCase().includes('install') || 
                                        innerHTML.includes('📱') ||
                                        text.includes('Add to') ||
                                        id.toLowerCase().includes('install') ||
                                        className.toLowerCase().includes('install');
                
                const isTopLeft = style.position === 'fixed' && 
                                parseInt(style.top) <= 50 && 
                                parseInt(style.left) <= 50;
                
                if (hasInstallContent || (isTopLeft && element.tagName === 'BUTTON')) {
                    console.log('🗑️ Removing suspicious install element:', element.tagName, text, id, className);
                    element.remove();
                    removed = true;
                }
            });
            
            return removed;
        }

        // DISABLED: Continuous aggressive cleanup - this was preventing PWA prompts
        // setInterval(() => {
        //     removeInstallButtons();
        // }, 200);

      // Additional cleanup on page visibility change (tab switching)
      document.addEventListener("visibilitychange", () => {
        if (!document.hidden) {
          console.log("� Page became visible - running cleanup");
          setTimeout(() => {
            for (let i = 0; i < 5; i++) {
              setTimeout(() => removeInstallButtons(), i * 100);
            }
          }, 100);
        }
      });

      // Cleanup on page focus
      window.addEventListener("focus", () => {
        console.log("🔄 Window focused - running cleanup");
        setTimeout(() => {
          for (let i = 0; i < 5; i++) {
            setTimeout(() => removeInstallButtons(), i * 100);
          }
        }, 100);
      });

      // Listen for app installation
      window.addEventListener("appinstalled", (evt) => {
        console.log("🎉 PWA was installed successfully");
      });

      // Check for product save success from AddNewProduct page
      function checkForProductSaveSuccess() {
        console.log("🔍 Checking for product save success...");
        const successData = sessionStorage.getItem("productSaveSuccess");
        console.log("📦 Success data from sessionStorage:", successData);

        if (successData) {
          try {
            const data = JSON.parse(successData);
            const timeDiff = Date.now() - data.timestamp;

            console.log("⏰ Time difference:", timeDiff, "ms");
            console.log("💬 Message:", data.message);

            // Only show notification if it's recent (within 10 seconds)
            if (timeDiff < 10000) {
              console.log("✅ Showing success notification");
              showNotification("Success!", data.message, "success");
            } else {
              console.log("⏰ Notification too old, skipping");
            }

            // Remove the success data after displaying
            sessionStorage.removeItem("productSaveSuccess");
            console.log("🧹 Success data removed from sessionStorage");
          } catch (error) {
            console.error("❌ Error parsing product save success data:", error);
            sessionStorage.removeItem("productSaveSuccess");
          }
        } else {
          console.log("📭 No success data found in sessionStorage");
        }
      }

      // Notification system with alert fallback
      function showNotification(title, message, type = "info") {
        console.log("🔔 showNotification called:", { title, message, type });

        // Show alert as immediate fallback
        alert(`${title}: ${message}`);

        // Also try to show visual notification
        try {
          // Wait for DOM to be ready and get container
          const getContainer = () => {
            let container = document.getElementById("notificationContainer");

            if (!container) {
              console.error(
                "❌ Notification container not found! Creating fallback..."
              );

              // Create fallback notification container if it doesn't exist
              const fallbackContainer = document.createElement("div");
              fallbackContainer.id = "notificationContainer";
              fallbackContainer.className = "notification-container";
              fallbackContainer.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                max-width: 400px;
                pointer-events: none;
              `;
              document.body.appendChild(fallbackContainer);
              container = fallbackContainer;
              console.log("✅ Fallback notification container created");
            }

            return container;
          };

          const container = getContainer();
          console.log("✅ Using notification container:", container); // Create notification element
          const notification = document.createElement("div");
          notification.className = "notification";

          // Add inline styles for better visibility (fallback if CSS fails)
          notification.style.cssText = `
          background: ${
            type === "error"
              ? "#fee2e2"
              : type === "success"
              ? "#d1fae5"
              : type === "warning"
              ? "#fef3c7"
              : "#dbeafe"
          };
          border: 1px solid ${
            type === "error"
              ? "#f87171"
              : type === "success"
              ? "#34d399"
              : type === "warning"
              ? "#fbbf24"
              : "#60a5fa"
          };
          border-radius: 8px;
          padding: 12px 16px;
          margin-bottom: 8px;
          display: flex;
          align-items: center;
          gap: 12px;
          color: ${
            type === "error"
              ? "#dc2626"
              : type === "success"
              ? "#059669"
              : type === "warning"
              ? "#d97706"
              : "#2563eb"
          };
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          font-size: 14px;
          box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
          pointer-events: auto;
          max-width: 350px;
          word-wrap: break-word;
        `;

          // Set icon based on type
          let icon = "fa-info-circle";
          if (type === "success") icon = "fa-check-circle";
          else if (type === "warning") icon = "fa-exclamation-triangle";
          else if (type === "error") icon = "fa-times-circle";
          else if (type === "tab-switch") icon = "fa-exchange-alt";

          notification.innerHTML = `
                <div class="notification-icon" style="font-size: 18px; flex-shrink: 0;">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="notification-content" style="flex: 1;">
                    <div class="notification-title" style="font-weight: 600; margin-bottom: 2px;">${title}</div>
                    <div class="notification-message" style="font-size: 13px; opacity: 0.8;">${message}</div>
                </div>
                <button class="notification-close" onclick="closeNotification(this)" style="background: none; border: none; color: inherit; cursor: pointer; padding: 4px; opacity: 0.6; font-size: 16px;">
                    <i class="fas fa-times"></i>
                </button>
            `;

          // Add to container
          container.appendChild(notification);
          console.log("📨 Notification added to container");

          // Initial state for animation
          notification.style.transform = "translateX(100%)";
          notification.style.transition = "all 0.3s ease-out";

          // Trigger show animation
          setTimeout(() => {
            notification.classList.add("show");
            notification.style.transform = "translateX(0)";
            console.log("🎬 Notification animation triggered");
          }, 50);

          // Auto-hide after 4 seconds
          setTimeout(() => {
            hideNotification(notification);
          }, 4000);

          return notification;
        } catch (visualNotificationError) {
          console.error(
            "❌ Visual notification failed:",
            visualNotificationError
          );
          // Alert already shown above, so just continue
        }
      }

      function hideNotification(notification) {
        if (!notification || !notification.parentNode) {
          console.log("⚠️ Notification already removed or invalid");
          return;
        }

        console.log("🫥 Hiding notification");
        notification.classList.add("hide");
        notification.style.transform = "translateX(100%)";
        notification.style.opacity = "0";

        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
            console.log("🗑️ Notification removed from DOM");
          }
        }, 300);
      }

      function closeNotification(closeButton) {
        const notification = closeButton.closest(".notification");
        hideNotification(notification);
      }

      // Demo product data with complete information for detailed product pages
      const demoProducts = [
        {
          id: 1,
          productCode: "DRESS001",
          name: "Designer Silk Evening Dress",
          location: "Showroom",
          image:
            "https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=400&h=300&fit=crop",
          owner: "mine",
          coverImage:
            "https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1566479179817-c0e4b3c9efb4?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?w=400&h=300&fit=crop",
          ],
          department: "production",
          quantity: 15,
          remarks:
            "Premium quality silk dress with intricate embroidery work. Handle with care during transportation.",
          createdAt: "2024-01-15T10:30:00Z",
          category: "clothing",
        },
        {
          id: 2,
          productCode: "100000000016",
          name: "Luxury Leather Handbag",
          location: "Inventory",
          image:
            "https://images.unsplash.com/photo-1584917865442-de89df76afd3?w=400&h=300&fit=crop",
          owner: "mine",
          coverImage:
            "https://images.unsplash.com/photo-1584917865442-de89df76afd3?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1584917865442-de89df76afd3?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1594223274512-ad4803739b7c?w=400&h=300&fit=crop",
          ],
          department: "sampling",
          quantity: 8,
          remarks:
            "Italian leather handbag collection. Premium quality materials used. Limited edition series.",
          createdAt: "2024-01-20T14:15:00Z",
          category: "accessories",
        },
        {
          id: 3,
          productCode: "WATCH003",
          name: "Swiss Automatic Watch",
          location: "Hard Goods",
          image:
            "https://images.unsplash.com/photo-1524592094714-0f0654e20314?w=400&h=300&fit=crop",
          owner: "all",
          coverImage:
            "https://images.unsplash.com/photo-1524592094714-0f0654e20314?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1524592094714-0f0654e20314?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1606859428786-1497b47d9df5?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?w=400&h=300&fit=crop",
          ],
          department: "tech",
          quantity: 25,
          remarks:
            "Precision timepiece with automatic movement. Water resistant up to 50m. Swiss made quality.",
          createdAt: "2024-01-10T09:45:00Z",
          category: "accessories",
        },
        {
          id: 4,
          productCode: "100000000012",
          name: "Italian Leather Loafers",
          location: "Showroom",
          image:
            "https://images.unsplash.com/photo-1549298916-b41d501d3772?w=400&h=300&fit=crop",
          owner: "mine",
          coverImage:
            "https://images.unsplash.com/photo-1549298916-b41d501d3772?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1549298916-b41d501d3772?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1560769629-975ec94e6a86?w=400&h=300&fit=crop",
          ],
          department: "production",
          quantity: 12,
          remarks:
            "Handcrafted Italian leather shoes. Available in multiple sizes. Premium comfort guarantee.",
          createdAt: "2024-01-25T16:20:00Z",
          category: "footwear",
        },
        {
          id: 5,
          productCode: "110000000021",
          name: "Premium Leather Jacket",
          location: "Factory",
          image:
            "https://images.unsplash.com/photo-1551028719-00167b16eac5?w=400&h=300&fit=crop",
          owner: "all",
          coverImage:
            "https://images.unsplash.com/photo-1551028719-00167b16eac5?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1551028719-00167b16eac5?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1539533018447-63fcce2678e3?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1544441893-675973e31985?w=400&h=300&fit=crop",
          ],
          department: "hard goods",
          quantity: 6,
          remarks:
            "Premium grade leather jacket with modern cut. Limited edition collection. Weather resistant.",
          createdAt: "2024-01-18T11:30:00Z",
          category: "clothing",
        },
        {
          id: 6,
          name: "iPhone 15 Pro Max",
          location: "Hard Goods",
          image:
            "https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=400&h=300&fit=crop",
          owner: "all",
          coverImage:
            "https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1603302576837-37561b2e2302?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1592910147829-6f2c3a5b7faf?w=400&h=300&fit=crop",
          ],
          department: "tech",
          quantity: 30,
          remarks:
            "Latest iPhone model with advanced camera system and titanium build. Includes all accessories.",
          createdAt: "2024-01-22T13:45:00Z",
          category: "electronics",
        },
        {
          id: 7,
          name: "Couture Evening Gown",
          location: "Inventory",
          image:
            "https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=400&h=300&fit=crop",
          owner: "mine",
          coverImage:
            "https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1617137984095-74e4e5e3613f?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1566479179817-c0e4b3c9efb4?w=400&h=300&fit=crop",
          ],
          department: "sampling",
          quantity: 3,
          remarks:
            "Haute couture evening gown with beaded details. One-of-a-kind piece. Handle with extreme care.",
          createdAt: "2024-01-12T08:20:00Z",
          category: "clothing",
        },
        {
          id: 8,
          name: "Wireless Noise Cancelling Headphones",
          location: "Hard Goods",
          image:
            "https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?w=400&h=300&fit=crop",
          owner: "all",
          coverImage:
            "https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1484704849700-f032a568e944?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400&h=300&fit=crop",
          ],
          department: "tech",
          quantity: 45,
          remarks:
            "Premium wireless headphones with active noise cancellation. 30-hour battery life. Includes case.",
          createdAt: "2024-01-08T15:10:00Z",
          category: "electronics",
        },
        {
          id: 9,
          name: "Designer Sunglasses",
          location: "Showroom",
          image:
            "https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400&h=300&fit=crop",
          owner: "mine",
          coverImage:
            "https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1508296695146-257a814070b4?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=400&h=300&fit=crop",
          ],
          department: "front desk",
          quantity: 20,
          remarks:
            "Designer sunglasses with UV protection. Multiple frame colors available. Includes protective case.",
          createdAt: "2024-01-28T12:00:00Z",
          category: "accessories",
        },
        {
          id: 10,
          name: "Gaming Laptop",
          location: "Hard Goods",
          image:
            "https://images.unsplash.com/photo-1603302576837-37561b2e2302?w=400&h=300&fit=crop",
          owner: "all",
          coverImage:
            "https://images.unsplash.com/photo-1603302576837-37561b2e2302?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1603302576837-37561b2e2302?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1525547719571-a2d4ac8945e2?w=400&h=300&fit=crop",
          ],
          department: "tech",
          quantity: 18,
          remarks:
            "High-performance gaming laptop with RTX graphics. 144Hz display. Perfect for gaming and work.",
          createdAt: "2024-01-05T09:30:00Z",
          category: "electronics",
        },
        {
          id: 11,
          name: "Modern Office Desk",
          location: "Hard Goods",
          image:
            "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop",
          owner: "mine",
          coverImage:
            "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1541558869434-2840d308329a?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=400&h=300&fit=crop",
          ],
          department: "hard goods",
          quantity: 10,
          remarks:
            "Ergonomic modern office desk with cable management. Adjustable height feature. Easy assembly.",
          createdAt: "2024-01-17T14:45:00Z",
          category: "furniture",
        },
        {
          id: 12,
          name: "MacBook Pro 16-inch",
          location: "Hard Goods",
          image:
            "https://images.unsplash.com/photo-1541807084-5c52b6b3adef?w=400&h=300&fit=crop",
          owner: "all",
          coverImage:
            "https://images.unsplash.com/photo-1541807084-5c52b6b3adef?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1541807084-5c52b6b3adef?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1496171367470-9ed9a91ea931?w=400&h=300&fit=crop",
          ],
          department: "tech",
          quantity: 12,
          remarks:
            "Latest MacBook Pro with M3 chip. Professional grade performance. Includes charger and documentation.",
          createdAt: "2024-01-14T16:25:00Z",
          category: "electronics",
        },
        {
          id: 13,
          name: "Ergonomic Office Chair",
          location: "Hard Goods",
          image:
            "https://images.unsplash.com/photo-1506439773649-6e0eb8cfb237?w=400&h=300&fit=crop",
          owner: "mine",
          coverImage:
            "https://images.unsplash.com/photo-1506439773649-6e0eb8cfb237?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1506439773649-6e0eb8cfb237?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=400&h=300&fit=crop",
          ],
          department: "production",
          quantity: 22,
          remarks:
            "Ergonomic office chair with lumbar support. Breathable mesh back. 5-year warranty included.",
          createdAt: "2024-01-11T11:15:00Z",
          category: "furniture",
        },
        {
          id: 14,
          name: "Wireless Bluetooth Speaker",
          location: "Hard Goods",
          image:
            "https://images.unsplash.com/photo-1608043152269-423dbba4e7e1?w=400&h=300&fit=crop",
          owner: "all",
          coverImage:
            "https://images.unsplash.com/photo-1608043152269-423dbba4e7e1?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1608043152269-423dbba4e7e1?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1545454675-3531b543be5d?w=400&h=300&fit=crop",
          ],
          department: "tech",
          quantity: 35,
          remarks:
            "Portable Bluetooth speaker with 360-degree sound. Waterproof design. 20-hour battery life.",
          createdAt: "2024-01-19T13:50:00Z",
          category: "electronics",
        },
        {
          id: 15,
          name: "Athletic Running Shoes",
          location: "Factory",
          image:
            "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400&h=300&fit=crop",
          owner: "mine",
          coverImage:
            "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1551107696-a4b0c5a0d9a2?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1560769629-975ec94e6a86?w=400&h=300&fit=crop",
          ],
          department: "sampling",
          quantity: 40,
          remarks:
            "Professional athletic running shoes with advanced cushioning. Multiple sizes available. Lightweight design.",
          createdAt: "2024-01-23T10:35:00Z",
          category: "footwear",
        },
        {
          id: 16,
          name: "Smart Fitness Tracker",
          location: "Hard Goods",
          image:
            "https://images.unsplash.com/photo-1575311373937-040b8e1fd5b6?w=400&h=300&fit=crop",
          owner: "all",
          coverImage:
            "https://images.unsplash.com/photo-1575311373937-040b8e1fd5b6?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1575311373937-040b8e1fd5b6?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1544258943-e0c2b2ed4e96?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1434494878577-86c23bcb06b9?w=400&h=300&fit=crop",
          ],
          department: "tech",
          quantity: 28,
          remarks:
            "Advanced fitness tracker with heart rate monitoring. GPS enabled. 7-day battery life.",
          createdAt: "2024-01-26T15:40:00Z",
          category: "electronics",
        },
        {
          id: 17,
          name: "Designer Wool Coat",
          location: "Showroom",
          image:
            "https://images.unsplash.com/photo-1539533018447-63fcce2678e3?w=400&h=300&fit=crop",
          owner: "mine",
          coverImage:
            "https://images.unsplash.com/photo-1539533018447-63fcce2678e3?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1539533018447-63fcce2678e3?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1551028719-00167b16eac5?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1544441893-675973e31985?w=400&h=300&fit=crop",
          ],
          department: "production",
          quantity: 8,
          remarks:
            "Premium wool designer coat. Italian craftsmanship. Perfect for winter season. Dry clean only.",
          createdAt: "2024-01-09T12:20:00Z",
          category: "clothing",
        },
        {
          id: 18,
          name: "Professional Camera Kit",
          location: "Hard Goods",
          image:
            "https://images.unsplash.com/photo-1606983340126-99ab4feaa64a?w=400&h=300&fit=crop",
          owner: "all",
          coverImage:
            "https://images.unsplash.com/photo-1606983340126-99ab4feaa64a?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1606983340126-99ab4feaa64a?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1502920917128-1aa500764cbd?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?w=400&h=300&fit=crop",
          ],
          department: "tech",
          quantity: 5,
          remarks:
            "Professional DSLR camera kit with multiple lenses. Perfect for photography professionals. Includes accessories.",
          createdAt: "2024-01-16T09:10:00Z",
          category: "electronics",
        },
        {
          id: 19,
          name: "Luxury Perfume Set",
          location: "Inventory",
          image:
            "https://images.unsplash.com/photo-1541643600914-78b084683601?w=400&h=300&fit=crop",
          owner: "mine",
          coverImage:
            "https://images.unsplash.com/photo-1541643600914-78b084683601?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1541643600914-78b084683601?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1588405748880-12d1d2a59db9?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1592945403244-b3fbafd7f539?w=400&h=300&fit=crop",
          ],
          department: "front desk",
          quantity: 15,
          remarks:
            "Exclusive luxury perfume collection. Limited edition set with gift packaging. Premium fragrance quality.",
          createdAt: "2024-01-21T14:55:00Z",
          category: "beauty",
        },
        {
          id: 20,
          name: "Mechanical Keyboard",
          location: "Hard Goods",
          image:
            "https://images.unsplash.com/photo-1587829741301-dc798b83add3?w=400&h=300&fit=crop",
          owner: "all",
          coverImage:
            "https://images.unsplash.com/photo-1587829741301-dc798b83add3?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1587829741301-dc798b83add3?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1527814050087-3793815479db?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1541140532154-b024d705b90a?w=400&h=300&fit=crop",
          ],
          department: "tech",
          quantity: 32,
          remarks:
            "Professional mechanical keyboard with RGB backlighting. Cherry MX switches. Programmable keys included.",
          createdAt: "2024-01-07T16:05:00Z",
          category: "electronics",
        },
        {
          id: 21,
          name: "Designer Backpack",
          location: "Showroom",
          image:
            "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400&h=300&fit=crop",
          owner: "mine",
          coverImage:
            "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1584917865442-de89df76afd3?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1622560480605-d83c853bc5c3?w=400&h=300&fit=crop",
          ],
          department: "sampling",
          quantity: 18,
          remarks:
            "Premium designer backpack with laptop compartment. Water-resistant material. Perfect for travel and work.",
          createdAt: "2024-01-24T11:25:00Z",
          category: "accessories",
        },
        {
          id: 22,
          name: "Tablet with Stylus",
          location: "Hard Goods",
          image:
            "https://images.unsplash.com/photo-1561154464-82e9adf32764?w=400&h=300&fit=crop",
          owner: "all",
          coverImage:
            "https://images.unsplash.com/photo-1561154464-82e9adf32764?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1561154464-82e9adf32764?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1585790050230-5dd28404ccb9?w=400&h=300&fit=crop",
          ],
          department: "tech",
          quantity: 14,
          remarks:
            "High-resolution tablet with pressure-sensitive stylus. Perfect for digital art and note-taking.",
          createdAt: "2024-01-13T13:15:00Z",
          category: "electronics",
        },
        {
          id: 23,
          name: "Crystal Jewelry Set",
          location: "Inventory",
          image:
            "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=300&fit=crop",
          owner: "mine",
          coverImage:
            "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1611652022419-a9419f74343d?w=400&h=300&fit=crop",
          ],
          department: "front desk",
          quantity: 7,
          remarks:
            "Elegant crystal jewelry set with matching necklace and earrings. Comes with luxury gift box.",
          createdAt: "2024-01-27T10:45:00Z",
          category: "jewelry",
        },
        {
          id: 24,
          name: "Smart Home Speaker",
          location: "Hard Goods",
          image:
            "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?w=400&h=300&fit=crop",
          owner: "all",
          coverImage:
            "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1545454675-3531b543be5d?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1608043152269-423dbba4e7e1?w=400&h=300&fit=crop",
          ],
          department: "tech",
          quantity: 26,
          remarks:
            "Voice-controlled smart speaker with AI assistant. Premium sound quality. Compatible with all smart devices.",
          createdAt: "2024-01-06T15:30:00Z",
          category: "electronics",
        },
        {
          id: 25,
          name: "Cashmere Winter Sweater",
          location: "Factory",
          image:
            "https://images.unsplash.com/photo-1434389677669-e08b4cac3105?w=400&h=300&fit=crop",
          owner: "mine",
          coverImage:
            "https://images.unsplash.com/photo-1434389677669-e08b4cac3105?w=800&h=600&fit=crop",
          images: [
            "https://images.unsplash.com/photo-1434389677669-e08b4cac3105?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1618932260643-eee4a2f652a6?w=400&h=300&fit=crop",
            "https://images.unsplash.com/photo-1564584217132-2271339fa2d6?w=400&h=300&fit=crop",
          ],
          department: "production",
          quantity: 16,
          remarks:
            "Luxurious cashmere sweater collection. Ultra-soft material. Available in multiple colors and sizes.",
          createdAt: "2024-01-29T08:50:00Z",
          category: "clothing",
        },
      ];

      // Pagination variables
      const itemsPerPage = 10;
      let currentPage = 1;
      let totalPages = 1;

      // Current filter state
      let currentTab = "mine";
      let currentFilter = "all";

      // Initialize the page when DOM is loaded
      document.addEventListener("DOMContentLoaded", function () {
        // Check for product save success notification
        checkForProductSaveSuccess();

        // IMMEDIATE NUCLEAR CLEANUP on page load
        console.log("🧹 DOM loaded - running NUCLEAR cleanup");

        // Run cleanup 20 times in first 2 seconds
        for (let i = 0; i < 20; i++) {
          setTimeout(() => {
            removeInstallButtons();

            // Extra aggressive - remove ALL fixed position buttons in top area
            const allButtons = document.querySelectorAll("button, div, span");
            allButtons.forEach((el) => {
              const style = window.getComputedStyle(el);
              if (
                style.position === "fixed" &&
                parseInt(style.top) <= 100 &&
                parseInt(style.left) <= 100 &&
                parseInt(style.zIndex) > 1000
              ) {
                console.log(
                  "🗑️ NUCLEAR: Removing high z-index fixed element in top area"
                );
                el.remove();
              }
            });
          }, i * 100);
        }

        renderProducts();
        renderPagination();
      });

      // Function to render products based on current filters and pagination
      function renderProducts() {
        const productsGrid = document.getElementById("productsGrid");

        // Filter products based on current tab and category filter
        let filteredProducts = demoProducts.filter((product) => {
          const tabMatch = currentTab === "all" || product.owner === currentTab;
          const categoryMatch =
            currentFilter === "all" || product.category === currentFilter;
          return tabMatch && categoryMatch;
        });

        // Calculate pagination
        totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const currentProducts = filteredProducts.slice(startIndex, endIndex);

        // Generate HTML for current page products
        productsGrid.innerHTML = currentProducts
          .map(
            (product) => `
                <div class="product-card" onclick="viewProduct(${product.id})">
                    <div class="product-image">
                        <img src="${product.image}" alt="${product.name}" loading="lazy">
                    </div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-info">
                        <div class="product-location">
                            <i class="fas fa-map-marker-alt location-icon"></i>
                            ${product.location}
                        </div>
                        <div class="department-badge">
                            ${product.department}
                        </div>
                    </div>
                </div>
            `
          )
          .join("");

        // Update pagination
        renderPagination();
      }

      // Function to render pagination controls
      function renderPagination() {
        const paginationContainer = document.getElementById(
          "paginationContainer"
        );

        if (totalPages <= 1) {
          paginationContainer.innerHTML = "";
          return;
        }

        let paginationHTML = "";

        // Previous button
        paginationHTML += `
                <button class="pagination-button" onclick="changePage(${
                  currentPage - 1
                })" ${currentPage === 1 ? "disabled" : ""}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;

        // Page numbers
        const maxVisiblePages = 5;
        let startPage = Math.max(
          1,
          currentPage - Math.floor(maxVisiblePages / 2)
        );
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

        // Adjust start page if we're near the end
        if (endPage - startPage < maxVisiblePages - 1) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        // First page and ellipsis if needed
        if (startPage > 1) {
          paginationHTML += `<button class="pagination-button" onclick="changePage(1)">1</button>`;
          if (startPage > 2) {
            paginationHTML += `<span class="pagination-info">...</span>`;
          }
        }

        // Page number buttons
        for (let i = startPage; i <= endPage; i++) {
          paginationHTML += `
                    <button class="pagination-button ${
                      i === currentPage ? "active" : ""
                    }" onclick="changePage(${i})">
                        ${i}
                    </button>
                `;
        }

        // Last page and ellipsis if needed
        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            paginationHTML += `<span class="pagination-info">...</span>`;
          }
          paginationHTML += `<button class="pagination-button" onclick="changePage(${totalPages})">${totalPages}</button>`;
        }

        // Next button
        paginationHTML += `
                <button class="pagination-button" onclick="changePage(${
                  currentPage + 1
                })" ${currentPage === totalPages ? "disabled" : ""}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;

        // Page info
        const filteredProducts = demoProducts.filter((product) => {
          const tabMatch = currentTab === "all" || product.owner === currentTab;
          const categoryMatch =
            currentFilter === "all" || product.category === currentFilter;
          return tabMatch && categoryMatch;
        });

        const startItem = (currentPage - 1) * itemsPerPage + 1;
        const endItem = Math.min(
          currentPage * itemsPerPage,
          filteredProducts.length
        );

        paginationHTML += `
                <div class="pagination-info">
                    ${startItem}-${endItem} of ${filteredProducts.length}
                </div>
            `;

        paginationContainer.innerHTML = paginationHTML;
      }

      // Function to change page
      function changePage(page) {
        if (page < 1 || page > totalPages) return;

        currentPage = page;
        renderProducts();

        // Scroll to top of products section
        document.querySelector(".products-section").scrollIntoView({
          behavior: "smooth",
          block: "start",
        });
      }

      // Function to switch between Mine and All tabs
      function switchTab(tab) {
        // Store previous tab for notification
        const previousTab = currentTab;

        // Update current tab state
        currentTab = tab;
        currentPage = 1; // Reset to first page when switching tabs

        // Update active tab button styling
        document.querySelectorAll(".tab-button").forEach((button) => {
          button.classList.remove("active");
        });

        // Add active class to clicked tab
        event.target.classList.add("active");

        // Re-render products with new filter
        renderProducts();

        // Show notification for tab switch
        if (previousTab !== tab) {
          const tabDisplay = tab.charAt(0).toUpperCase() + tab.slice(1);
          const productCount = demoProducts.filter((product) => {
            const tabMatch = tab === "all" || product.owner === tab;
            const categoryMatch =
              currentFilter === "all" || product.category === currentFilter;
            return tabMatch && categoryMatch;
          }).length;

          showNotification(
            `Switched to ${tabDisplay}`,
            `Now viewing ${productCount} products in ${tabDisplay} section`,
            "tab-switch"
          );
        }

        console.log(`Switched to ${tab} tab`);
      }

      // Function to toggle filter dropdown (placeholder for actual dropdown)
      function toggleFilter() {
        alert("Filter feature here - TBD");
      }

      // Function to handle search functionality
      function performSearch() {
        const searchTerm = document.getElementById("searchInput").value.trim();

        if (searchTerm) {
          console.log(`Searching for: ${searchTerm}`);
          // Here you would implement actual search logic
          alert(
            `Search functionality for "${searchTerm}" would be implemented here!`
          );
        } else {
          alert("Please enter a search term");
        }
      }

      // Function to handle search icon click (expand if collapsed, search if expanded)
      function handleSearchIconClick() {
        const searchContainer = document.getElementById("searchContainer");

        if (
          window.innerWidth <= 768 &&
          searchContainer.classList.contains("collapsed")
        ) {
          // If collapsed, expand it
          expandSearch();
          // Focus on the search input after expansion
          setTimeout(() => {
            document.getElementById("searchInput").focus();
          }, 300);
        } else {
          // If not collapsed or on desktop, perform search
          performSearch();
        }
      }

      // Function to handle profile icon click
      function openProfile() {
        console.log("Opening user profile");
        alert("Profile page - name, dept, email - TBD");
      }

      // Function to handle product card click
      function viewProduct(productId) {
        const product = demoProducts.find((p) => p.id === productId);

        if (product) {
          console.log("Viewing product:", product);

          // Store complete product data in sessionStorage
          sessionStorage.setItem("currentProduct", JSON.stringify(product));

          // Navigate to ProductDisplayPage with simple URL parameters
          const params = new URLSearchParams({
            id: product.id,
            name: product.name,
          });

          window.location.href = `ProductDisplayPage.html?${params.toString()}`;
        } else {
          console.error("Product not found:", productId);
          alert("Product not found");
        }
      }

      // Function to handle add new product button
      function addNewProduct() {
        console.log("Navigating to add new product page");
        window.location.href = "AddNewProduct.html";
      }

      // Function to open product number search
      function openProductNumberSearch() {
        console.log("Opening product number search");
        window.location.href = "ProductNumberSearch.html";
      }

      // Helper function to check camera availability and permissions
      async function checkCameraAvailability() {
        try {
          console.log("🔍 Checking camera availability...");

          // Check if mediaDevices is supported
          if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            throw new Error("MediaDevices API not supported");
          }

          // Check available devices
          const devices = await navigator.mediaDevices.enumerateDevices();
          const videoDevices = devices.filter(
            (device) => device.kind === "videoinput"
          );

          console.log("📹 Available video devices:", videoDevices.length);
          console.log(
            "📱 Video devices details:",
            videoDevices.map((d) => ({
              label: d.label || "Camera",
              deviceId: d.deviceId.substring(0, 8) + "...",
            }))
          );

          if (videoDevices.length === 0) {
            throw new Error("No camera devices found");
          }

          // Test camera access with minimal constraints
          const testStream = await navigator.mediaDevices.getUserMedia({
            video: { width: 320, height: 240 },
          });

          // Immediately stop the test stream
          testStream.getTracks().forEach((track) => track.stop());

          console.log("✅ Camera availability check passed");
          return true;
        } catch (error) {
          console.error("❌ Camera availability check failed:", error);

          // If it's a permission error, we can try to request permissions
          if (
            error.name === "NotAllowedError" ||
            error.name === "PermissionDeniedError"
          ) {
            console.log(
              "🔐 Camera permissions not granted - will request during camera opening"
            );
            return "permissions_needed";
          }

          return false;
        }
      }

      // Function to handle camera button - updated to actually open camera
      async function openCamera() {
        try {
          console.log("🎥 Opening camera for QR scanning...");

          // Pre-flight camera check
          const isAvailable = await checkCameraAvailability();
          if (isAvailable === false) {
            showNotification(
              "Camera Unavailable",
              "Camera is not available or accessible. Please check your device and try again.",
              "error"
            );
            return;
          } else if (isAvailable === "permissions_needed") {
            console.log("🔐 Camera permissions needed - requesting now...");
            showNotification(
              "Requesting Camera Access",
              "Please allow camera permissions when prompted...",
              "info"
            );

            // Continue to camera setup - the startCamera function will handle permission request
          } else {
            console.log("✅ Camera is available and ready");
          }

          // Mobile detection
          const isMobile =
            /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
              navigator.userAgent
            );
          const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
          const isAndroid = /Android/.test(navigator.userAgent);

          console.log("📱 Device detection:", { isMobile, isIOS, isAndroid });
          console.log("🌐 User Agent:", navigator.userAgent);
          console.log("🔒 Is Secure Context:", window.isSecureContext);
          console.log("📍 Location Protocol:", window.location.protocol);

          // Enhanced browser support detection for mobile
          if (!navigator.mediaDevices) {
            console.error("❌ MediaDevices API not available");
            showNotification(
              "Camera Error",
              "Camera API not supported. Please update your browser or use HTTPS.",
              "error"
            );
            return;
          }

          if (!navigator.mediaDevices.getUserMedia) {
            console.error("❌ getUserMedia not supported");
            showNotification(
              "Camera Error",
              "Camera access not supported. Please use a modern browser with HTTPS.",
              "error"
            );
            return;
          }

          // Check for HTTPS requirement on mobile (with development exceptions)
          const isDevelopment =
            window.location.hostname === "localhost" ||
            window.location.hostname === "127.0.0.1" ||
            window.location.hostname.startsWith("192.168.") ||
            window.location.hostname.endsWith(".local") ||
            window.location.port; // Any port usually indicates development

          if (
            isMobile &&
            window.location.protocol !== "https:" &&
            !isDevelopment
          ) {
            console.error(
              "❌ HTTPS required for camera access on mobile in production"
            );
            showNotification(
              "Security Error",
              "Camera access requires HTTPS on mobile devices in production. For development, use localhost or local IP addresses.",
              "error"
            );
            return;
          }

          if (isDevelopment) {
            console.log(
              "🔧 Development environment detected - allowing HTTP camera access"
            );
          }

          // Check if jsQR is available
          if (typeof jsQR === "undefined") {
            console.error("❌ jsQR library not loaded");
            showNotification(
              "QR Scanner Error",
              "QR Scanner library not loaded. Please refresh the page.",
              "error"
            );
            return;
          }

          console.log("✅ jsQR library is available");

          // Create video element for camera preview
          const videoElement = document.createElement("video");
          videoElement.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    object-fit: cover;
                    z-index: 9999;
                    background: black;
                `;
          videoElement.autoplay = true;
          videoElement.playsInline = true;
          videoElement.muted = true;

          // Create canvas for QR detection (hidden)
          const canvasElement = document.createElement("canvas");
          const canvasContext = canvasElement.getContext("2d");
          canvasElement.style.display = "none"; // Hide the canvas

          // Create QR scanner overlay
          const scannerOverlay = document.createElement("div");
          scannerOverlay.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            border: 2px solid #00ff00;
            border-radius: 12px;
            z-index: 10001;
            pointer-events: none;
        `;

          // Create scanner corners
          const corners = [
            "top-left",
            "top-right",
            "bottom-left",
            "bottom-right",
          ];
          corners.forEach((corner) => {
            const cornerElement = document.createElement("div");
            cornerElement.style.cssText = `
                position: absolute;
                width: 20px;
                height: 20px;
                border: 3px solid #00ff00;
                ${corner.includes("top") ? "top: -2px;" : "bottom: -2px;"}
                ${corner.includes("left") ? "left: -2px;" : "right: -2px;"}
                ${
                  corner.includes("top") && corner.includes("left")
                    ? "border-right: none; border-bottom: none;"
                    : ""
                }
                ${
                  corner.includes("top") && corner.includes("right")
                    ? "border-left: none; border-bottom: none;"
                    : ""
                }
                ${
                  corner.includes("bottom") && corner.includes("left")
                    ? "border-right: none; border-top: none;"
                    : ""
                }
                ${
                  corner.includes("bottom") && corner.includes("right")
                    ? "border-left: none; border-top: none;"
                    : ""
                }
            `;
            scannerOverlay.appendChild(cornerElement);
          });

          // Create instruction text
          const instructionText = document.createElement("div");
          instructionText.innerHTML = "Position QR code within the frame";
          instructionText.style.cssText = `
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 500;
            z-index: 10001;
            text-align: center;
        `;

          // Create close button
          const closeButton = document.createElement("button");
          closeButton.innerHTML = '<i class="fas fa-times"></i>';
          closeButton.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 10002;
                    background: rgba(0,0,0,0.7);
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 50px;
                    height: 50px;
                    font-size: 20px;
                    cursor: pointer;
                `;

          // Create permissions button for mobile troubleshooting
          const permissionsButton = document.createElement("button");
          permissionsButton.innerHTML = '<i class="fas fa-shield-alt"></i>';
          permissionsButton.style.cssText = `
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 10002;
            background: rgba(0,0,255,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 14px;
            cursor: pointer;
            display: ${isMobile ? "block" : "none"};
          `;

          // Create help button
          const helpButton = document.createElement("button");
          helpButton.innerHTML = '<i class="fas fa-question"></i>';
          helpButton.style.cssText = `
            position: fixed;
            top: ${isMobile ? "135px" : "80px"};
            right: 20px;
            z-index: 10002;
            background: rgba(255,165,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 14px;
            cursor: pointer;
          `;

          // Create flashlight toggle button
          const flashButton = document.createElement("button");
          flashButton.innerHTML = '<i class="fas fa-flashlight"></i>';
          flashButton.style.cssText = `
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10002;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 16px;
            cursor: pointer;
        `;

          //   Create capture button
          const captureButton = document.createElement("button");
          captureButton.innerHTML = '<i class="fas fa-camera"></i>';
          captureButton.style.cssText = `
                    position: fixed;
                    bottom: 30px;
                    left: 50%;
                    transform: translateX(-50%);
                    z-index: 10000;
                    background: #667eea;
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 70px;
                    height: 70px;
                    font-size: 24px;
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                `;

          // Create camera flip button (for mobile devices with multiple cameras)
          const flipButton = document.createElement("button");
          flipButton.innerHTML = '<i class="fas fa-sync-alt"></i>';
          flipButton.style.cssText = `
                    position: fixed;
                    bottom: 30px;
                    right: 30px;
                    z-index: 10002;
                    background: rgba(0,0,0,0.7);
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 50px;
                    height: 50px;
                    font-size: 16px;
                    cursor: pointer;
                `;

          // Camera state variables
          let currentFacingMode = "environment";
          let currentStream = null;
          let isFlashOn = false;
          let scanningInterval = null;
          let lastScanTime = 0;

          // Function to start camera
          async function startCamera(facingMode) {
            try {
              console.log("🎥 Starting camera with facing mode:", facingMode);

              // Stop current stream if exists
              if (currentStream) {
                currentStream.getTracks().forEach((track) => track.stop());
              }

              // Clear any existing scanning interval
              if (scanningInterval) {
                clearInterval(scanningInterval);
              }

              // Show permission request message on mobile
              if (isMobile) {
                instructionText.innerHTML = "Requesting camera access...";
                instructionText.style.background = "rgba(255,165,0,0.7)";
              }

              // Enhanced mobile-optimized camera constraints
              let constraints = {
                video: {
                  facingMode: facingMode,
                  width: { ideal: 1280, max: 1920, min: 320 },
                  height: { ideal: 720, max: 1080, min: 240 },
                  frameRate: { ideal: 30, max: 60, min: 10 },
                },
              };

              // iOS-specific adjustments
              if (isIOS) {
                console.log("📱 Applying iOS-specific camera constraints");
                constraints = {
                  video: {
                    facingMode: { ideal: facingMode },
                    width: { ideal: 640, max: 1280, min: 320 },
                    height: { ideal: 480, max: 720, min: 240 },
                    frameRate: { ideal: 15, max: 30, min: 10 },
                  },
                };
              }

              // Android-specific adjustments
              if (isAndroid) {
                console.log("📱 Applying Android-specific camera constraints");
                constraints = {
                  video: {
                    facingMode: { exact: facingMode },
                    width: { ideal: 640, max: 1280, min: 320 },
                    height: { ideal: 480, max: 720, min: 240 },
                    frameRate: { ideal: 20, max: 30, min: 10 },
                  },
                };
              }

              console.log(
                "📱 Requesting camera with constraints:",
                constraints
              );

              // Request camera permission with enhanced user feedback
              const permissionTimeout = new Promise(
                (_, reject) =>
                  setTimeout(() => {
                    reject(
                      new Error(
                        "Camera permission request timed out - please check your browser settings"
                      )
                    );
                  }, 20000) // Increased timeout for mobile users
              );

              // Show different messages during permission request
              let permissionMessage = isMobile
                ? "Please allow camera access in the browser popup..."
                : "Requesting camera permissions...";

              if (isMobile) {
                showNotification(
                  "Camera Permission",
                  permissionMessage,
                  "info"
                );
              }

              const cameraRequest =
                navigator.mediaDevices.getUserMedia(constraints);

              try {
                currentStream = await Promise.race([
                  cameraRequest,
                  permissionTimeout,
                ]);
                console.log(
                  "✅ Camera permissions granted and stream obtained"
                );

                // Clear permission message
                if (isMobile) {
                  showNotification(
                    "Camera Access Granted",
                    "Camera is now ready!",
                    "success"
                  );
                }
              } catch (permissionError) {
                if (permissionError.name === "NotAllowedError") {
                  throw new Error(
                    "Camera permission denied by user. Please allow camera access and try again."
                  );
                } else if (permissionError.message.includes("timeout")) {
                  throw new Error(
                    "Camera permission request timed out. Please refresh and try again, making sure to allow camera access when prompted."
                  );
                } else {
                  throw permissionError;
                }
              }

              console.log("✅ Camera stream obtained:", currentStream);

              // Set video source and wait for it to load
              videoElement.srcObject = currentStream;

              // Enhanced video loading with mobile-specific handling
              await new Promise((resolve, reject) => {
                const videoTimeout = setTimeout(() => {
                  reject(new Error("Video load timeout"));
                }, 15000);

                videoElement.onloadedmetadata = () => {
                  clearTimeout(videoTimeout);
                  console.log(
                    "✅ Video metadata loaded, dimensions:",
                    videoElement.videoWidth,
                    "x",
                    videoElement.videoHeight
                  );

                  // Force play for mobile compatibility
                  const playPromise = videoElement.play();

                  if (playPromise !== undefined) {
                    playPromise
                      .then(() => {
                        console.log("✅ Video is now playing");
                        resolve();
                      })
                      .catch((playError) => {
                        console.error("❌ Video play error:", playError);
                        // Try to play without sound for iOS compatibility
                        videoElement.muted = true;
                        videoElement.playsInline = true;
                        videoElement
                          .play()
                          .then(() => {
                            console.log("✅ Video playing (muted)");
                            resolve();
                          })
                          .catch(reject);
                      });
                  } else {
                    console.log("✅ Video play (no promise)");
                    resolve();
                  }
                };

                videoElement.onerror = (error) => {
                  clearTimeout(videoTimeout);
                  console.error("❌ Video error:", error);
                  reject(error);
                };

                // Handle cases where metadata might already be loaded
                if (videoElement.readyState >= 1) {
                  clearTimeout(videoTimeout);
                  console.log("✅ Video metadata already available");
                  resolve();
                }
              });

              // Set canvas dimensions to match video
              canvasElement.width = videoElement.videoWidth || 640;
              canvasElement.height = videoElement.videoHeight || 480;

              console.log(
                "📐 Canvas dimensions set to:",
                canvasElement.width,
                "x",
                canvasElement.height
              );

              // Start QR code scanning
              startQRScanning();

              // Update instruction text
              instructionText.innerHTML =
                "Camera ready - Position QR code within the frame";
              instructionText.style.background = "rgba(0,128,0,0.7)";

              return currentStream;
            } catch (error) {
              console.error("❌ Error starting camera:", error);

              // Enhanced fallback with multiple attempts
              try {
                console.log("🔄 Trying enhanced fallback camera access...");

                // First fallback: Remove facingMode restriction
                let fallbackConstraints = {
                  video: {
                    width: { ideal: 640, max: 1280, min: 320 },
                    height: { ideal: 480, max: 720, min: 240 },
                    frameRate: { ideal: 15, max: 30, min: 10 },
                  },
                };

                currentStream = await navigator.mediaDevices.getUserMedia(
                  fallbackConstraints
                );
                videoElement.srcObject = currentStream;

                await new Promise((resolve, reject) => {
                  const timeout = setTimeout(
                    () => reject(new Error("Fallback video timeout")),
                    10000
                  );

                  videoElement.onloadedmetadata = () => {
                    clearTimeout(timeout);
                    console.log("✅ Fallback video metadata loaded");
                    const playPromise = videoElement.play();

                    if (playPromise !== undefined) {
                      playPromise
                        .then(() => {
                          console.log("✅ Fallback video playing");
                          resolve();
                        })
                        .catch(() => {
                          // Final attempt with all mobile settings
                          videoElement.muted = true;
                          videoElement.playsInline = true;
                          videoElement.play().then(resolve).catch(reject);
                        });
                    } else {
                      resolve();
                    }
                  };

                  videoElement.onerror = (err) => {
                    clearTimeout(timeout);
                    reject(err);
                  };
                });

                canvasElement.width = videoElement.videoWidth || 640;
                canvasElement.height = videoElement.videoHeight || 480;

                startQRScanning();

                instructionText.innerHTML =
                  "Camera ready - Position QR code within the frame";
                instructionText.style.background = "rgba(0,128,0,0.7)";

                console.log("✅ Fallback camera access successful");
                return currentStream;
              } catch (fallbackError) {
                console.error("❌ Fallback camera also failed:", fallbackError);

                // Second fallback: Try with minimal constraints
                try {
                  console.log("🔄 Trying minimal constraints fallback...");

                  currentStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                  });
                  videoElement.srcObject = currentStream;

                  await new Promise((resolve, reject) => {
                    const timeout = setTimeout(
                      () => reject(new Error("Minimal fallback timeout")),
                      8000
                    );

                    videoElement.onloadedmetadata = () => {
                      clearTimeout(timeout);
                      videoElement.muted = true;
                      videoElement.playsInline = true;
                      videoElement.play().then(resolve).catch(reject);
                    };

                    videoElement.onerror = (err) => {
                      clearTimeout(timeout);
                      reject(err);
                    };
                  });

                  canvasElement.width = videoElement.videoWidth || 640;
                  canvasElement.height = videoElement.videoHeight || 480;

                  startQRScanning();

                  instructionText.innerHTML = "Camera ready (minimal mode)";
                  instructionText.style.background = "rgba(255,165,0,0.7)";

                  console.log("✅ Minimal constraints fallback successful");
                  return currentStream;
                } catch (minimalError) {
                  console.error(
                    "❌ All camera fallbacks failed:",
                    minimalError
                  );
                  throw minimalError;
                }
              }
            }
          }

          // Function to start QR code scanning
          function startQRScanning() {
            console.log("🔍 Starting QR code detection...");

            // Clear any existing scanning interval
            if (scanningInterval) {
              clearInterval(scanningInterval);
            }

            scanningInterval = setInterval(() => {
              try {
                if (videoElement.readyState === videoElement.HAVE_ENOUGH_DATA) {
                  // Ensure canvas dimensions match video
                  if (
                    canvasElement.width !== videoElement.videoWidth ||
                    canvasElement.height !== videoElement.videoHeight
                  ) {
                    canvasElement.width = videoElement.videoWidth;
                    canvasElement.height = videoElement.videoHeight;
                  }

                  // Draw the video frame to canvas
                  canvasContext.drawImage(
                    videoElement,
                    0,
                    0,
                    canvasElement.width,
                    canvasElement.height
                  );

                  // Get image data from canvas
                  const imageData = canvasContext.getImageData(
                    0,
                    0,
                    canvasElement.width,
                    canvasElement.height
                  );

                  // Scan for QR codes
                  const qrCode = jsQR(
                    imageData.data,
                    imageData.width,
                    imageData.height,
                    {
                      inversionAttempts: "dontInvert",
                    }
                  );

                  if (qrCode) {
                    // Throttle QR code detection to prevent multiple rapid detections
                    const currentTime = Date.now();
                    if (currentTime - lastScanTime > 2000) {
                      // 2 second cooldown
                      lastScanTime = currentTime;
                      console.log("🎯 QR Code detected:", qrCode.data);
                      handleQRCodeDetected(qrCode.data);
                    }
                  }
                }
              } catch (scanError) {
                console.error("❌ Error during QR scanning:", scanError);
              }
            }, 100); // Scan every 100ms
          }

          // Function to handle QR code detection
          function handleQRCodeDetected(qrData) {
            console.log("🎯 QR Code detected:", qrData);

            // Stop scanning to prevent multiple detections
            if (scanningInterval) {
              clearInterval(scanningInterval);
              scanningInterval = null;
            }

            // Show success feedback
            scannerOverlay.style.borderColor = "#00ff00";
            scannerOverlay.style.boxShadow = "0 0 20px #00ff00";
            instructionText.innerHTML = "QR Code Detected!";
            instructionText.style.background = "rgba(0,255,0,0.8)";

            // Vibrate if supported
            if (navigator.vibrate) {
              navigator.vibrate(200);
            }

            // Process QR code data
            processQRCodeData(qrData);

            // Auto-close after 2 seconds
            setTimeout(() => {
              closeCamera();
            }, 500);
          }

          // Function to process QR code data
          function processQRCodeData(qrData) {
            try {
              console.log("🔍 Processing QR data:", qrData);

              // First, check if QR data contains "|" delimiter
              if (qrData.includes("|")) {
                console.log(
                  "📊 QR data contains delimiter '|' - parsing as product code"
                );
                handleDelimitedQRCode(qrData);
                return;
              }

              // Try to parse as JSON for structured data
              let parsedData;
              try {
                parsedData = JSON.parse(qrData);
                console.log("📦 Parsed QR JSON data:", parsedData);

                // Handle structured product data
                if (parsedData.productId || parsedData.id) {
                  handleProductQRCode(parsedData);
                } else if (parsedData.url) {
                  handleURLQRCode(parsedData.url);
                } else {
                  handleGenericQRCode(parsedData);
                }
              } catch (jsonError) {
                // If not JSON, handle as plain text
                console.log("📝 QR data is plain text:", qrData);

                // Check if it's a URL
                if (
                  qrData.startsWith("http://") ||
                  qrData.startsWith("https://")
                ) {
                  handleURLQRCode(qrData);
                } else {
                  // Try to match product ID patterns or handle as text
                  handleTextQRCode(qrData);
                }
              }
            } catch (error) {
              console.error("❌ Error processing QR code:", error);
              showNotification(
                "QR Code Error",
                "Unable to process QR code data",
                "error"
              );
            }
          }

          // Function to handle delimited QR codes (format: "PRODUCTCODE|additional|data")
          function handleDelimitedQRCode(qrData) {
            try {
              console.log("🔧 Processing delimited QR code:", qrData);

              // Split by "|" delimiter and get the first element as product code
              const qrParts = qrData.split("|");
              const productCode = qrParts[0].trim();

              console.log("🏷️  Extracted product code:", productCode);
              console.log("📋 Additional QR data parts:", qrParts.slice(1));

              if (!productCode) {
                showNotification(
                  "Invalid QR Code",
                  "Product code is empty or invalid",
                  "error"
                );
                return;
              }

              // Find product by matching the product code with product ID or name
              const product = demoProducts.find((p) => {
                // Check if product code matches ID, name, or a product code field
                return (
                  p.id.toString() === productCode ||
                  p.name.toLowerCase().includes(productCode.toLowerCase()) ||
                  (p.productCode && p.productCode === productCode)
                );
              });

              if (product) {
                console.log("✅ Product found for code:", productCode, product);
                showNotification(
                  "Product Found!",
                  `Opening ${product.name}`,
                  "success"
                );

                // Redirect to product detail page after a short delay
                setTimeout(() => {
                  viewProduct(product.id);
                }, 500);
              } else {
                console.log("❌ No product found for code:", productCode);
                showNotification(
                  "Product Not Found",
                  `No product found with code: ${productCode}`,
                  "warning"
                );

                // Optionally, you could redirect to a search page or product list
                setTimeout(() => {
                  console.log(
                    "🔍 Could redirect to search page with code:",
                    productCode
                  );
                  // window.location.href = `ProductSearch.html?code=${encodeURIComponent(productCode)}`;
                }, 2000);
              }
            } catch (error) {
              console.error("❌ Error processing delimited QR code:", error);
              showNotification(
                "QR Processing Error",
                "Unable to process product code",
                "error"
              );
            }
          }

          // Function to handle product QR codes
          function handleProductQRCode(productData) {
            const productId = productData.productId || productData.id;

            // Find product in demo data
            const product = demoProducts.find((p) => p.id == productId);

            if (product) {
              showNotification(
                "Product Found!",
                `Opening ${product.name}`,
                "success"
              );

              setTimeout(() => {
                viewProduct(product.id);
              }, 1500);
            } else {
              showNotification(
                "Product Not Found",
                `Product ID ${productId} not found in database`,
                "warning"
              );
            }
          }

          // Function to handle URL QR codes
          function handleURLQRCode(url) {
            showNotification("URL Detected", "Opening website...", "info");

            setTimeout(() => {
              if (confirm(`Open this URL?\n${url}`)) {
                window.open(url, "_blank");
              }
            }, 1500);
          }

          // Function to handle text QR codes
          function handleTextQRCode(text) {
            // Check if text matches a product ID pattern
            const productIdMatch = text.match(
              /(?:product|id|item)[:\s]*(\d+)/i
            );

            if (productIdMatch) {
              const productId = parseInt(productIdMatch[1]);
              handleProductQRCode({ productId });
            } else {
              // Show generic text data
              showNotification(
                "QR Code Scanned",
                `Data: ${text.substring(0, 50)}${
                  text.length > 50 ? "..." : ""
                }`,
                "info"
              );

              // Copy to clipboard
              if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                  setTimeout(() => {
                    showNotification(
                      "Copied",
                      "QR code data copied to clipboard",
                      "success"
                    );
                  }, 1500);
                });
              }
            }
          }

          // Function to handle generic structured QR codes
          function handleGenericQRCode(data) {
            console.log("Generic QR data:", data);
            showNotification(
              "QR Code Scanned",
              "Structured data detected",
              "info"
            );

            // You can add more specific handling based on your QR code structure
            // For example: inventory codes, location codes, etc.
          }

          // Start initial camera
          console.log("🚀 Starting initial camera setup...");
          await startCamera(currentFacingMode);

          // Add elements to page
          document.body.appendChild(videoElement);
          document.body.appendChild(canvasElement); // Add hidden canvas
          document.body.appendChild(scannerOverlay);
          document.body.appendChild(instructionText);
          document.body.appendChild(closeButton);
          document.body.appendChild(flashButton);
          document.body.appendChild(flipButton);
          if (isMobile) {
            document.body.appendChild(permissionsButton);
          }
          document.body.appendChild(helpButton);

          // Close camera function
          function closeCamera() {
            console.log("🛑 Closing camera...");

            if (scanningInterval) {
              clearInterval(scanningInterval);
              scanningInterval = null;
            }
            if (currentStream) {
              currentStream.getTracks().forEach((track) => track.stop());
              currentStream = null;
            }

            // Remove all elements
            [
              videoElement,
              canvasElement,
              scannerOverlay,
              instructionText,
              closeButton,
              flashButton,
              flipButton,
              permissionsButton,
              helpButton,
            ].forEach((element) => {
              if (element && element.parentNode) {
                document.body.removeChild(element);
              }
            });
          }

          // Request permissions function (mobile helper)
          async function requestCameraPermissions() {
            try {
              console.log("🔐 Manually requesting camera permissions...");
              showNotification(
                "Requesting Camera Permission",
                "Please allow camera access in the browser popup...",
                "info"
              );

              // Update instruction text
              instructionText.innerHTML = "Requesting camera permissions...";
              instructionText.style.background = "rgba(255,165,0,0.7)";

              const stream = await navigator.mediaDevices.getUserMedia({
                video: true,
              });
              stream.getTracks().forEach((track) => track.stop());

              showNotification(
                "Permission Granted!",
                "Camera permissions granted successfully! Scanner should work now.",
                "success"
              );

              // Update instruction text
              instructionText.innerHTML =
                "Permission granted! Restarting camera...";
              instructionText.style.background = "rgba(0,128,0,0.7)";

              // Restart camera with granted permissions
              setTimeout(() => {
                startCamera(currentFacingMode);
              }, 1000);
            } catch (error) {
              console.error("❌ Permission request failed:", error);

              let errorMsg = "Camera permission was denied.";
              if (isMobile) {
                errorMsg +=
                  "\n\nPlease:\n1. Refresh the page\n2. Allow camera access when prompted\n3. Check browser settings if needed\n4. Try a different browser";
              } else {
                errorMsg +=
                  " Please check your browser settings and try again.";
              }

              showNotification("Permission Denied", errorMsg, "error");

              // Update instruction text
              instructionText.innerHTML =
                "Permission denied - tap the permissions button to try again";
              instructionText.style.background = "rgba(255,0,0,0.7)";
            }
          }

          // Show help function
          function showCameraHelp() {
            const helpText = isMobile
              ? "📱 Mobile Camera Help:\n\n1. Allow camera permissions when browser asks\n2. Look for camera/microphone icon in address bar\n3. Tap 'Allow' on permission popup\n4. Use Chrome, Safari, or Firefox browsers\n5. Ensure good lighting for QR scanning\n6. Close other camera apps completely\n7. Restart browser if issues persist\n8. Check device privacy/camera settings\n\n💡 If permission popup doesn't appear, tap the blue shield button to request manually."
              : "🖥️ Desktop Camera Help:\n\n1. Allow camera permissions in browser\n2. Check if another program is using camera\n3. Look for camera icon in address bar\n4. Try refreshing the page\n5. Ensure camera is properly connected\n6. Check Windows camera privacy settings\n7. Restart browser if needed";

            showNotification("Camera Help & Troubleshooting", helpText, "info");
          }

          // Flip camera function
          async function flipCamera() {
            try {
              currentFacingMode =
                currentFacingMode === "environment" ? "user" : "environment";
              console.log("🔄 Flipping camera to:", currentFacingMode);
              await startCamera(currentFacingMode);
            } catch (error) {
              console.error("❌ Error flipping camera:", error);
              showNotification(
                "Camera Error",
                "Unable to switch camera",
                "error"
              );
            }
          }

          // Toggle flashlight function
          async function toggleFlashlight() {
            try {
              const track = currentStream.getVideoTracks()[0];
              const capabilities = track.getCapabilities();

              if (capabilities.torch) {
                isFlashOn = !isFlashOn;
                await track.applyConstraints({
                  advanced: [{ torch: isFlashOn }],
                });

                flashButton.style.color = isFlashOn ? "#ffff00" : "white";
                flashButton.style.background = isFlashOn
                  ? "rgba(255,255,0,0.3)"
                  : "rgba(0,0,0,0.7)";
                showNotification(
                  "Flashlight",
                  isFlashOn ? "ON" : "OFF",
                  "info"
                );
              } else {
                showNotification(
                  "Flashlight",
                  "Not supported on this device",
                  "warning"
                );
              }
            } catch (error) {
              console.error("❌ Error toggling flashlight:", error);
              showNotification(
                "Flashlight Error",
                "Unable to control flashlight",
                "error"
              );
            }
          }

          // Add event listeners
          closeButton.addEventListener("click", closeCamera);
          flipButton.addEventListener("click", flipCamera);
          flashButton.addEventListener("click", toggleFlashlight);
          if (isMobile) {
            permissionsButton.addEventListener(
              "click",
              requestCameraPermissions
            );
          }
          helpButton.addEventListener("click", showCameraHelp);

          // Close on escape key
          const escapeHandler = (e) => {
            if (e.key === "Escape") {
              closeCamera();
              document.removeEventListener("keydown", escapeHandler);
            }
          };
          document.addEventListener("keydown", escapeHandler);

          console.log("✅ QR Scanner camera setup completed successfully");

          // Show mobile-specific guidance with permission tips
          if (isMobile) {
            setTimeout(() => {
              showNotification(
                "📱 Mobile QR Scanner Ready",
                "Tips for best results:\n• Allow camera permissions when prompted\n• Hold phone steady\n• Ensure good lighting\n• Position QR code in center\n• Keep camera 6-12 inches away\n\n💡 Use the blue shield button if you need to request permissions again.",
                "info"
              );
            }, 1500);
          } else {
            setTimeout(() => {
              showNotification(
                "🖥️ Desktop QR Scanner Ready",
                "Camera is ready for QR scanning!\n• Allow camera permissions if prompted\n• Position QR codes clearly in view\n• Press ESC to close scanner",
                "success"
              );
            }, 1000);
          }
        } catch (error) {
          console.error("❌ Error accessing camera:", error);

          let errorMessage = "Unable to access camera. ";
          let errorTitle = "Camera Error";

          // Enhanced mobile-specific error handling
          if (error.name === "NotAllowedError") {
            errorTitle = "Camera Access Denied";
            if (isMobile) {
              errorMessage +=
                "Please:\n1. Allow camera permissions in browser settings\n2. Refresh the page\n3. Try using Chrome or Safari\n4. Ensure you're using HTTPS";
            } else {
              errorMessage += "Please allow camera permissions and try again.";
            }
          } else if (error.name === "NotFoundError") {
            errorTitle = "No Camera Found";
            if (isMobile) {
              errorMessage +=
                "No camera detected on your device. Please:\n1. Check if another app is using the camera\n2. Restart your browser\n3. Try a different browser";
            } else {
              errorMessage += "No camera found on this device.";
            }
          } else if (error.name === "NotSupportedError") {
            errorTitle = "Camera Not Supported";
            if (isMobile) {
              errorMessage +=
                "Camera not supported. Please:\n1. Update your browser to the latest version\n2. Use Chrome, Safari, or Firefox\n3. Enable camera permissions in device settings";
            } else {
              errorMessage += "Camera is not supported on this device/browser.";
            }
          } else if (error.name === "NotReadableError") {
            errorTitle = "Camera In Use";
            if (isMobile) {
              errorMessage +=
                "Camera is busy. Please:\n1. Close other camera apps\n2. Restart your browser\n3. Check if another tab is using the camera";
            } else {
              errorMessage +=
                "Camera is already in use by another application.";
            }
          } else if (error.message && error.message.includes("timeout")) {
            errorTitle = "Camera Timeout";
            if (isMobile) {
              errorMessage =
                "Camera took too long to respond. Please:\n1. Check your internet connection\n2. Restart the browser\n3. Try again in a few seconds";
            } else {
              errorMessage += "Camera connection timed out. Please try again.";
            }
          } else if (error.message && error.message.includes("HTTPS")) {
            errorTitle = "Security Error";
            const isDevelopment =
              window.location.hostname === "localhost" ||
              window.location.hostname === "127.0.0.1" ||
              window.location.hostname.startsWith("192.168.") ||
              window.location.hostname.endsWith(".local") ||
              window.location.port;

            if (isDevelopment) {
              errorMessage =
                "Development environment detected but camera still requires secure context. Try:\n1. Use localhost instead of IP if possible\n2. Check browser camera permissions\n3. Restart browser with --unsafely-treat-insecure-origin-as-secure flag";
            } else {
              errorMessage =
                "Camera access requires HTTPS in production. Please:\n1. Use https:// instead of http://\n2. Contact support for HTTPS setup\n3. For development, use localhost or local addresses";
            }
          } else {
            if (isMobile) {
              errorMessage = `Mobile camera error: ${error.message}. Try:\n1. Refreshing the page\n2. Using a different browser\n3. Checking camera permissions\n4. Ensuring HTTPS connection`;
            } else {
              errorMessage += `Error: ${error.message}`;
            }
          }

          showNotification(errorTitle, errorMessage, "error");

          // Additional mobile guidance
          if (isMobile) {
            setTimeout(() => {
              showNotification(
                "Mobile Camera Help",
                "For best results on mobile:\n• Use Chrome or Safari\n• Allow camera permissions\n• Use HTTPS connection\n• Close other camera apps",
                "info"
              );
            }, 3000);
          }
        }
      }

      // Add search functionality on Enter key press
      document
        .getElementById("searchInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            performSearch();
          }
        });

      // Voice recording functionality
      let mediaRecorder;
      let audioChunks = [];
      let isRecording = false;
      let recordingStartTime;
      let timerInterval;

      // Function to toggle voice recording with proper state management
      function toggleVoiceRecording() {
        if (!isRecording) {
          startVoiceRecording();
        } else {
          stopVoiceRecording();
        }
      }

      // Mobile UI State Management
      let isMobileViewActive = false;

      // Function to check if mobile view is active
      function isMobileView() {
        return window.innerWidth <= 768;
      }

      // Function to reset mobile states
      function resetMobileStates() {
        if (!isMobileView()) return;

        const voiceContainer = document.getElementById(
          "voiceRecorderContainer"
        );
        const searchContainer = document.getElementById("searchContainer");

        // Remove all state classes
        voiceContainer.classList.remove("expanded", "collapsed");
        searchContainer.classList.remove("expanded", "collapsed");
      }

      // Function to expand voice recorder on mobile
      function expandVoiceRecorder() {
        if (!isMobileView()) return;

        const voiceContainer = document.getElementById(
          "voiceRecorderContainer"
        );
        const searchContainer = document.getElementById("searchContainer");

        // Clean state and apply new classes
        resetMobileStates();

        voiceContainer.classList.add("expanded");
        searchContainer.classList.add("collapsed");
      }

      // Function to collapse voice recorder on mobile
      function collapseVoiceRecorder() {
        if (!isMobileView()) return;

        setTimeout(() => {
          if (!isRecording) {
            // Only collapse if not recording
            resetMobileStates();
          }
        }, 300);
      }

      // Function to expand search on mobile
      function expandSearch() {
        if (!isMobileView()) return;

        const voiceContainer = document.getElementById(
          "voiceRecorderContainer"
        );
        const searchContainer = document.getElementById("searchContainer");

        // Clean state and apply new classes
        resetMobileStates();

        searchContainer.classList.add("expanded");
        voiceContainer.classList.add("collapsed");
      }

      // Function to collapse search on mobile
      function collapseSearch() {
        if (!isMobileView()) return;

        setTimeout(() => {
          resetMobileStates();
        }, 150);
      }

      // Function to handle search icon click (expand if collapsed, search if expanded)
      function handleSearchIconClick() {
        const searchContainer = document.getElementById("searchContainer");

        if (isMobileView() && searchContainer.classList.contains("collapsed")) {
          expandSearch();
          setTimeout(() => {
            document.getElementById("searchInput").focus();
          }, 350);
        } else {
          performSearch();
        }
      }

      // Handle window resize to reset states
      window.addEventListener("resize", function () {
        if (!isMobileView()) {
          resetMobileStates();
        }
      });

      // Function to toggle mobile profile sidebar
      function toggleMobileSidebar() {
        const sidebar = document.getElementById("mobileProfileSidebar");
        const overlay = document.getElementById("sidebarOverlay");
        const hamburger = document.querySelector(".hamburger-menu");

        sidebar.classList.toggle("open");
        overlay.classList.toggle("show");
        hamburger.classList.toggle("active");
      }

      // Function to close mobile profile sidebar
      function closeMobileSidebar() {
        const sidebar = document.getElementById("mobileProfileSidebar");
        const overlay = document.getElementById("sidebarOverlay");
        const hamburger = document.querySelector(".hamburger-menu");

        sidebar.classList.remove("open");
        overlay.classList.remove("show");
        hamburger.classList.remove("active");
      }

      // Function to open notifications
      function openNotifications() {
        console.log("Opening notifications");
        alert("Notifications page - TBD");
        closeMobileSidebar();
      }

      // Function to open help
      function openHelp() {
        console.log("Opening help");
        alert("Help & Support page - TBD");
        closeMobileSidebar();
      }

      // Function to open settings
      function openSettings() {
        console.log("Opening settings");
        alert("Settings page - TBD");
        closeMobileSidebar();
      }

      // Function to logout
      function logout() {
        console.log("Logout clicked");
        alert("Logout feature to be implemented - TBD");
        closeMobileSidebar();
      }

      // Close sidebar when clicking outside or pressing escape
      document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
          closeMobileSidebar();
        }
      });

      // Function to start voice recording
      async function startVoiceRecording() {
        try {
          // Check if browser supports MediaRecorder
          if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            alert("Voice recording is not supported in this browser");
            return;
          }

          // Request microphone access
          const stream = await navigator.mediaDevices.getUserMedia({
            audio: true,
          });

          // Initialize MediaRecorder
          mediaRecorder = new MediaRecorder(stream);
          audioChunks = [];

          // Set up event handlers
          mediaRecorder.ondataavailable = (event) => {
            audioChunks.push(event.data);
          };

          mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
            const audioUrl = URL.createObjectURL(audioBlob);

            // Here you would typically send the audio to your server for processing
            console.log("Recording completed:", audioUrl);

            // Stop all audio tracks to release microphone
            stream.getTracks().forEach((track) => track.stop());
          };

          // Start recording
          mediaRecorder.start();
          isRecording = true;
          recordingStartTime = Date.now();

          // Update UI and expand voice recorder
          updateRecordingUI();
          expandVoiceRecorder();
          startRecordingTimer();

          console.log("Voice recording started");
        } catch (error) {
          console.error("Error accessing microphone:", error);
          alert(
            "Unable to access microphone. Please check your browser permissions."
          );
        }
      }

      // Function to stop voice recording
      function stopVoiceRecording() {
        if (mediaRecorder && isRecording) {
          mediaRecorder.stop();
          isRecording = false;

          // Update UI and collapse voice recorder
          updateRecordingUI();
          clearInterval(timerInterval);
          collapseVoiceRecorder();

          console.log("Voice recording stopped");
        }
      }

      // Function to update recording UI
      function updateRecordingUI() {
        const voiceBtn = document.getElementById("voiceRecorderBtn");
        const voiceIcon = document.getElementById("voiceIcon");
        const voiceText = document.getElementById("voiceText");

        if (isRecording) {
          voiceBtn.classList.add("recording");
          voiceIcon.className = "fas fa-stop voice-icon";
          voiceText.textContent = "Stop Recording";
        } else {
          voiceBtn.classList.remove("recording");
          voiceIcon.className = "fas fa-microphone voice-icon";
          voiceText.textContent = "Voice Search";
          document.getElementById("recordingTimer").textContent = "00:00";
        }
      }

      // Function to start recording timer
      function startRecordingTimer() {
        timerInterval = setInterval(() => {
          if (isRecording) {
            const elapsedTime = Date.now() - recordingStartTime;
            const seconds = Math.floor(elapsedTime / 1000);
            const minutes = Math.floor(seconds / 60);
            const displaySeconds = seconds % 60;

            const timeString = `${minutes
              .toString()
              .padStart(2, "0")}:${displaySeconds.toString().padStart(2, "0")}`;
            document.getElementById("recordingTimer").textContent = timeString;

            // Auto-stop after 5 minutes
            if (seconds >= 300) {
              stopVoiceRecording();
              alert("Recording automatically stopped after 5 minutes");
            }
          }
        }, 1000);
      }

      // 🧪 TESTING HELPER FUNCTIONS - Remove in production
      console.log("🧪 QR Testing Helper Functions Available:");
      console.log("📋 Available product codes for testing:");
      demoProducts.slice(0, 5).forEach((product) => {
        if (product.productCode) {
          console.log(`   • ${product.productCode} - ${product.name}`);
        }
      });
      console.log("🔍 Test QR codes to scan:");
      console.log("   • DRESS001|Size:M|Color:Blue");
      console.log("   • BAG002|Material:Leather|Type:Handbag");
      console.log("   • WATCH003|Brand:Swiss|Model:Automatic");
      console.log("   • SHOE004|Size:42|Color:Brown");
      console.log("   • JACKET005|Size:L|Season:Winter");

      // Function to generate test QR data
      window.generateTestQR = function (productCode, additionalData = "") {
        const qrData = additionalData
          ? `${productCode}|${additionalData}`
          : productCode;
        console.log("Generated QR data:", qrData);
        return qrData;
      };

      // Mobile camera troubleshooting helper
      window.troubleshootMobileCamera = async function () {
        console.log("🔧 Starting mobile camera troubleshooting...");

        const isMobile =
          /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
            navigator.userAgent
          );
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);

        console.log("� Device Info:");
        console.log("  Mobile:", isMobile);
        console.log("  iOS:", isIOS);
        console.log("  Android:", isAndroid);
        console.log("  User Agent:", navigator.userAgent);
        console.log("  Secure Context:", window.isSecureContext);
        console.log("  Protocol:", window.location.protocol);
        console.log("  Hostname:", window.location.hostname);

        // Check MediaDevices API
        console.log("🎥 Camera API Check:");
        console.log("  navigator.mediaDevices:", !!navigator.mediaDevices);
        console.log("  getUserMedia:", !!navigator.mediaDevices?.getUserMedia);

        // Check available devices
        try {
          const devices = await navigator.mediaDevices.enumerateDevices();
          const cameras = devices.filter((d) => d.kind === "videoinput");
          console.log("  Camera devices found:", cameras.length);
          cameras.forEach((cam, i) => {
            console.log(`    Camera ${i + 1}:`, cam.label || "Unknown Camera");
          });
        } catch (error) {
          console.log("  Device enumeration error:", error.message);
        }

        // Test basic camera access
        try {
          console.log("🧪 Testing basic camera access...");
          const stream = await navigator.mediaDevices.getUserMedia({
            video: true,
          });
          console.log("✅ Basic camera access: SUCCESS");
          stream.getTracks().forEach((track) => track.stop());
        } catch (error) {
          console.log("❌ Basic camera access: FAILED");
          console.log("  Error:", error.name, "-", error.message);
        }

        // Mobile-specific recommendations
        if (isMobile) {
          console.log("📱 Mobile Troubleshooting Steps:");
          console.log(
            "1. For development: Use localhost, 127.0.0.1, or local IP addresses"
          );
          console.log("2. For production: Ensure HTTPS connection");
          console.log("3. Use Chrome, Safari, or Firefox browsers");
          console.log("4. Allow camera permissions when prompted");
          console.log("5. Close other camera apps completely");
          console.log("6. Restart browser if issues persist");
          console.log("7. Check device privacy settings");

          const isDevelopment =
            window.location.hostname === "localhost" ||
            window.location.hostname === "127.0.0.1" ||
            window.location.hostname.startsWith("192.168.") ||
            window.location.hostname.endsWith(".local") ||
            window.location.port;

          if (!isDevelopment && window.location.protocol !== "https:") {
            console.log(
              "⚠️  WARNING: HTTPS required for mobile camera access in production"
            );
            console.log("   Current URL:", window.location.href);
            console.log(
              "   Try: https://" +
                window.location.hostname +
                window.location.pathname
            );
          } else if (isDevelopment) {
            console.log(
              "✅ Development environment detected - HTTP camera access allowed"
            );
          } else {
            console.log(
              "✅ Secure HTTPS connection - camera access should work"
            );
          }
        }
      };

      console.log(
        "�💡 Use generateTestQR('DRESS001', 'Size:M|Color:Blue') to generate test data"
      );
      console.log(
        "📞 Call troubleshootMobileCamera() for mobile camera diagnostics"
      );
    </script>
  </body>
</html>
